let Extensions=(function(){function $U(task){return JsUrl('admin/extensions/'+task);}
function callback(res){if(res.ok()){if(target){target=target.close();}
_backlist.refresh();}
(target||_backlist).notify(res.message);}
function compile(_target){let f=JsForm({btn:_target});if(f){if(!f.getForm().output){f.request({url:$U('confirm_compile'),modalOptions:{onLoad:function(){target.close();target=compile(this);},},},false,'modal');}else{f.request($U('compile'),callback);}}
return _target;}
function getContent(i,value){switch(i){case 5:return'<a href="'+value+'" target="_blank">'+value+'</a>';case 6:let x='';for(let j in value){x+='<div title="'+value[j]+'" class="badge badge-primary text-uppercase">'+j+'</div>';}
return x;case 7:return value.split(',').join(',<br />');case 8:return value.split(',').join(', ');}
return value;}
let _backlist,target;let mo={size:'large',onLoad:function(){target=this;JsForm({btn:this}).request($U('save'),callback);},};let _controls={edit:{numRows:'1',modalOptions:mo,},create:{modalOptions:mo,},confirm_status:{onlyRows:'owner',modalOptions:{onLoad:function(){target=this;JsForm({btn:this}).request($U('status'),callback);},},},confirm_delete:{modalOptions:{onLoad:function(){target=this;JsForm({btn:this}).request($U('delete'),callback);},},},confirm_dbhistory:{numRows:'1',modalOptions:{size:'large',onLoad:function(){target=this;JsForm({btn:this}).request($U('dbhistory'),callback);},},},edit_readme:{numRows:'1',modalOptions:{size:'large',onLoad:function(){target=this;JsForm({btn:this}).request($U('update_readme'),callback);},},},details:function(el){try{let html='';let caption=JSON.parse(document.getElementById('details-caption').innerHTML);let options=JSON.parse(document.getElementById(el.getAttribute('data-value')).innerHTML);for(let i=0,L=options.content.length;i<L;i++){if(options.content[i]){html+='<tr><th>'+caption[i]+':</th><td>'+getContent(i,options.content[i])+'</td></tr>';}}
options.content='<table class="table table-condensed table-auto">'+html+'</table>';Modal(options).show();}catch(e){alert(e);}},confirm_append:{numRows:'1',onlyRows:'package',modalOptions:{onLoad:function(){target=this;JsForm({btn:this}).request($U('append'),callback);},},},confirm_compile:{onlyRows:'package',modalOptions:{onLoad:function(){target=compile(this);},},},distribute:{data:{format:'blank'},load:'blank'},};return{List:function(){if(!_backlist){_backlist=Backlist().url($U).controls(_controls).allowHistory().load();}
return _backlist;},setControls:function(controls){for(let i in controls){_controls[i]=controls[i];}},};})();(function(){function $U(task){return JsUrl('admin/extensions.changes/'+task);}
function List(target){function callback(res){if(res.ok()){if(target_2){target_2=target_2.close();}
_backlist.refresh();}
(target_2||target).notify(res.message);}
let target_2;let mo={size:'large',target:target,onLoad:function(){target_2=this;JsForm({btn:this}).request($U('save'),callback);},};let _backlist=Backlist('changes');_backlist.url($U).controls({create:{modalOptions:mo,},edit:{numRows:'1',modalOptions:mo,},confirm_delete:{modalOptions:{target:target,onLoad:function(){target_2=this;JsForm({btn:this}).request($U('delete'),callback);},},},}).data({extension_id:_backlist.getFormValue('extension_id')}).load();};Extensions.setControls({changes:{url:$U('index'),numRows:'1',modalOptions:{size:'large',onLoad:function(){List(this);}},},});})();(function(){function $U(task){return JsUrl('admin/extensions.developers/'+task);}
function List(target){function callback(res){if(res.ok()){if(target_2){target_2=target_2.close();}
_backlist.refresh();}
(target_2||target).notify(res.message);}
let target_2;let mo={size:'large',target:target,onLoad:function(){target_2=this;JsForm({btn:this}).request($U('save'),callback);},};let _backlist=Backlist('developers').url($U).controls({edit:{numRows:'1',modalOptions:mo,},create:{modalOptions:mo,},confirm_delete:{numRows:'1',modalOptions:{target:target,onLoad:function(){target_2=this;JsForm({btn:this})?.request($U('delete'),callback);},},},}).load();};Extensions.setControls({developers:{url:$U('index'),numRows:'*',modalOptions:{size:'large',onLoad:function(){List(this);}},},});})();let Installer=(function(){function $U(task){return JsUrl('admin/extensions.installer/'+task);}
function setCleanerEvents(clean){let a=clean.querySelector('#clean-all');let b=clean.querySelectorAll('input[name="clean_paths[]"]');let L=b.length;a.addEventListener('change',function(){for(let i=0;i<L;i++){b[i].checked=a.checked;}});for(let i=0;i<L;i++){b[i].addEventListener('change',function(){if(this.checked){let x=0;for(let i=0;i<L;i++){if(b[i].checked==true){x++;}}
a.checked=L==x;}else{a.checked=false;}});}}
function callback(res){if(res.ok()){if(target){target=target.close();}
_backlist.refresh();}
(target||_backlist).notify(res.message);}
let _backlist,target;let _controls={confirm_install:{modalOptions:{size:'large',onLoad:function(){target=this;JsTabs('#installer-tabs')?.select();let clean=target.getElement().querySelector('.ei-clean');if(clean){setCleanerEvents(clean);}
JsForm({btn:this}).request($U('install'),callback);},},},confirm_delete:{modalOptions:{onLoad:function(){target=this;JsForm({btn:this}).request($U('delete'),callback);},},},confirm_find_updates:{numRows:'*',modalOptions:{size:'small',onLoad:function(){target=this;JsForm({btn:this}).request($U('find_updates'),callback);},},},confirm_update_all:{numRows:'*',modalOptions:{size:'small',onLoad:function(){target=this;JsForm({btn:this}).request($U('update_all'),callback);},},},confirm_upload:{numRows:'*',modalOptions:{onLoad:function(){target=this;JsForm({btn:this}).request($U('upload'),callback);},},},confirm_download:{modalOptions:{onLoad:function(){target=this;let f=JsForm({btn:this});if(f){f.request($U('download'),callback);}}},},confirm_unzip:{modalOptions:{size:'small',onLoad:function(){target=this;JsForm({btn:this}).request($U('unzip'),callback);}},},confirm_maintenance:{numRows:'*',modalOptions:{size:'small',onLoad:function(){target=this;JsForm({btn:this}).request($U('maintenance'),callback);},},},show_failure:{onlyRows:'failed',numRows:'1',modalOptions:{onLoad:function(){target=this;},},}};return{List:function(){if(!_backlist){_backlist=Backlist().url($U).controls(_controls).allowHistory().load();}
return _backlist;},setControls:function(controls){for(let i in controls){_controls[i]=controls[i];}},};})();(function(){let _backlist,target;function $U(task){return JsUrl('admin/extensions.installer/'+task);}
function callback(res){if(!_backlist){_backlist=Extensions.List();}
if(res.ok()){if(target){target=target.close();}
_backlist.refresh();}
(target||_backlist).notify(res.message);};Extensions.setControls({confirm_find_updates:{url:$U('confirm_find_updates'),numRows:'*',modalOptions:{size:'small',onLoad:function(){target=this;JsForm({btn:this}).request($U('find_updates'),callback);}},},update:{url:$U('confirm_update'),numRows:'1',modalOptions:{size:'small',onLoad:function(){target=this;JsForm({btn:this}).request($U('update'),callback);}},},confirm_update_all:{url:$U('confirm_update_all'),numRows:'*',modalOptions:{size:'small',onLoad:function(){target=this;JsForm({btn:this}).request($U('update_all'),callback);},},},});})();function JsRating(box,options){function getElements(box){if(typeof box=='string'){box=document.querySelector(box);}
if(box&&box.getAttribute('data-rating')){return[box];}
return(box||document).querySelectorAll('*[data-rating]')||[];}
function getValue(el){let value=el.getAttribute('data-rating');if(value.includes('|')){value=getAverage(value);}
if(parseInt(value)==parseFloat(value)){return parseInt(value);}
return parseFloat(value).toFixed(1);}
function getAverage(value){let t=p=0;let sum=value.split('|').reduce(function(a,n){n=parseInt(n);t+=n;return a+=(++p)*n;},0);return t?(sum/t):0;}
function setStars(stars,value){let half=parseInt(value)!==value;let css='';value-=1;for(let i=0;i<5;i++){if(i<=value){css='fa-solid fa-star';}else if(half){half=false;css='fa-solid fa-star-half-stroke';}else{css='fa-regular fa-star';}
stars[i].className=css;}}
if(typeof box=='object'&&typeof box.tagName=='undefined'){options=box;box=undefined;}
options=Object.assign({type:'default',span:undefined,onLoad:undefined,onSelect:undefined,onToggle:undefined},options);let elements=getElements(box);elements.forEach(function(el){el.innerHTML='<i></i>'.repeat(5)+el.innerHTML;let value=getValue(el);let stars=el.querySelectorAll('i');if(options.type=='default'){el.appendChild(JsElement('span',{html:'('+value+')'}));}else if(options.span){options.span.innerHTML=value;}
setStars(stars,value);if(options.onSelect){el.setAttribute('tabindex',0);el.setAttribute('role','radiogroup');stars.forEach(function(star,i){star.value=i+1;star.addEventListener('mouseover',function(){setStars(stars,star.value);if(options.onToggle){options.onToggle.call(star,true)}});star.addEventListener('mouseout',function(){setStars(stars,value);if(options.onToggle){options.onToggle.call(star,false)}});star.addEventListener('click',function(event){if(options.onSelect.call(star,event)!==false){value=star.value;}});});}else{el.setAttribute('aria-label',el.getAttribute('aria-label').replace('$val',value));el.setAttribute('role','img');}
if(options.onLoad){el.value=value;options.onLoad.call(el);}});}
function JsRatingDetail(el,options){options=Object.assign({value:undefined,},options);if(!Array.isArray(options.value)){options.value=el.getAttribute('data-rating-detail').split('|');}
options.value=options.value.map(function(v){return parseInt(v);});let total=options.value.reduce(function(t,v){return t+v;},0);JsRating(el,{type:'basic',span:el.querySelector('span'),});let ol=el.appendChild(JsElement('ol'));ol.setAttribute('aria-hidden',true);options.value.forEach(function(value,i){let width=0;if(value){width=parseInt(value/total*100);}
ol.insertBefore(JsElement('li',{html:'<div><div class="measuring-bar"><div style="width: '+width+'%;"></div></div></div>'
+'<div>'+(i+1)+'<i class="fa-solid fa-star"></i></div>'}),ol.firstChild);});}
function JsRatingHolder(){let el,values,dftValue;return{setElement:function(box){el=box.querySelector('span');let value=box.getAttribute('data-value');if(value){values=[''].concat(value.split('|'));}
return this;},setDefaultValue:function(value){dftValue=value;return this;},print:function(status,value){if(!status){value=dftValue;}
if(values){value=values[value];}
el.innerHTML='('+value+')';return this;}}}
if(typeof JsFelem=='object'){JsFelem.implement({rating:function(el,form){let holder=JsRatingHolder();let name=el.getAttribute('data-name');JsRating(el,{onLoad:function(){holder.setElement(this).setDefaultValue(this.value).print(false);},onSelect:function(){holder.setDefaultValue(this.value);if(name){form[name].value=this.value;}},onToggle:function(status){holder.print(status,this.value);}});}});}
let Webstore=(function(){function $U(task){return JsUrl('admin/extensions.webstore/'+task);}
let _backlist,target;let _controls={confirm_download:{modalOptions:{onLoad:function(){target=this;JsForm({btn:this}).request($U('download'),function(res){if(res.ok()){if(target){target=target.close();}
_backlist.refresh();}
(target||_backlist).notify(res.message);});}}},};return{List:function(){if(!_backlist){_backlist=Backlist().url($U).controls(_controls).allowHistory().load({onSuccess:function(){JsRating();}});}
return _backlist;},setControls:function(controls){for(let i in controls){_controls[i]=controls[i];}},};})();