const Navbar=function(nav,btn,options){if(typeof nav=='string'){nav=document.querySelector(nav);}
if(typeof btn=='string'){btn=document.querySelector(btn);}
if(!nav||!btn){return;}
nav.toggle=function(value){if(value){this.classList.replace('navbar-mobile','navbar');}else{this.classList.replace('navbar','navbar-mobile');}};options=JsMergeOptions({},options);let curDisplay,displayValue,_nav;let parent=nav.parentNode;let sibling=nav.nextSibling;let body=document.body;let isOpen=0;let hasAccordion=nav.classList.contains('navbar-control');function Accordion(){let li=nav.querySelectorAll(':scope > ul > li');li.forEach(function(el,i){if(el.querySelector('ul')){let a=el.querySelector('a');a.href='javascript:void(0)';a.setAttribute('aria-expanded',el.classList.contains('expand'));a.addEventListener('keydown',function(event){if(event.key=='Enter'){minimizerFn(false);}});a.addEventListener('click',function(){if(options.fire('select',el)===false){return;}
li.forEach(function(el,j){let expanded=el.classList.contains('expand');let status=(i==j&&!expanded);if(expanded){if(!status){el.classList.remove('expand');}}else if(status){el.classList.add('expand');}
el.querySelector('a').setAttribute('aria-expanded',status);options.fire('change',el,status);});});}});}
let isInitialized=false;function initialize(){_nav=body.appendChild(JsElement('div.pull-navbar'));let _start,corrector;let _overlay=body.appendChild(JsElement('div.pull-overlay'));let _target=body.appendChild(JsElement('div.pull-target',{events:{click:function(){if(isOpen){_toggle();}}}}));function Escape(event){if(event.key=='Escape'){btn.click();}}
function _toggle(v){_nav.click();isOpen=body.classList.toggle('pull-on',v instanceof Event?undefined:v);if(isOpen){let a=_nav.querySelector('a');if(a){a.focus();}
document.addEventListener('keydown',Escape);}else{btn.focus();document.removeEventListener('keydown',Escape);}}
function _move(v){_nav.style.transition=['','initial'][v];_overlay.style.display=['','block'][v];}
JsMove(_target,function(event){let rect=event.target.getBoundingClientRect();_start={x:event.clientX,left:rect.left,right:(rect.left+rect.width),width:rect.width},corrector=_nav.getBoundingClientRect().width;_move(1);},function(event){let x=event.clientX,v=(_start.x-x);if(v<0){if(x<_start.right||x>corrector)return;x-=_start.width;}else if(v>0){if(x>_start.left)return;}else{return;}
_target.style.left=x+'px';_nav.style.transform='translateX('+(x-corrector)+'px)';},function(event){_target.style.left='';_nav.style.transform='';_move(0);_toggle((Math.abs(_start.left-event.clientX)>corrector/2)?!isOpen:isOpen);});if(btn){btn.addEventListener('click',_toggle);}
return true;}
function fn(){displayValue=window.getComputedStyle(btn).getPropertyValue('display');if(displayValue!==curDisplay){if(displayValue==='none'){if(isInitialized){parent.insertBefore(nav,sibling);}
nav.toggle(1);}else{if(!isInitialized){isInitialized=initialize();}
nav.toggle(0);_nav.appendChild(nav);}
if(hasAccordion){hasAccordion=false;Accordion();}
curDisplay=displayValue;body.classList.toggle('body-small',curDisplay!=='none');}}
let hash=nav.getAttribute('data-hash');if(hash){let el=nav.querySelector('[data-hash="'+hash+'"]');if(el){while(true){el=el.parentNode;if(el.tagName=='LI'){el.classList.add('selected');}else if(el==nav){break;}}}}
fn();window.addEventListener('resize',fn);let minimizer;function minimizerFn(force){if(force===undefined){force=JsCookie.get('BackendNavbar');}else{setCookie(force);}
body.classList.toggle('navbar-minimized',force);}
function setCookie(v){JsCookie.set('BackendNavbar',v?1:'');}
return{minimizer:function(slc){minimizer=document.querySelector(slc);minimizer.addEventListener('click',function(){setCookie(!body.classList.contains('navbar-minimized'));minimizerFn();});minimizerFn();}}};const JsTheme=function($btn){const storageName='prefers-color-scheme';const currentTheme=localStorage.getItem(storageName)||'auto';function getTheme(mode){if(mode==='auto'){return window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light';}
return mode;}
function set(mode){document.documentElement.setAttribute('data-theme',getTheme(mode));['dark','light','auto','hidden'].forEach((m)=>document.body.classList.toggle(`mode-${m}`,m==mode));}
$btn.parentNode.querySelectorAll('[data-value]').forEach(function($el){const mode=$el.getAttribute('data-value');if(currentTheme===mode){set(mode);}
$el.addEventListener('click',function(){localStorage.setItem(storageName,mode);document.body.click();set(mode);});});};var Backend=(function(){const controls=JsControls({tpl:{}});return{attach:function(name,fn){controls.attach('tpl',name,fn);},attachAll:function(obj){controls.attachAll('tpl',obj);},load:function(box){controls.load('tpl',box);}};})();window.addEventListener('DOMContentLoaded',function(){const el=Navbar('.navbar','.pull-btn');if(el){el.minimizer('.navbar-minimizer > a');}
const h=document.body.querySelector('.layout-header');if(h){JsFelem.load(h);}
Backend.load(document);});Backend.attach('search',function(el){let status=0;let data=null;const dd=el.parentNode.appendChild(JsElement('div'));const QR={'a':'[aáàâä]','e':'[eéèêë]','i':'[iíìîï]','o':'[oóòôö]','u':'[uúùûü]','n':'[nñ]'};const types=['fa-regular fa-window-maximize','fa-solid fa-gear'];function getRegExp(re){for(let i in QR){re=re.replace(RegExp(i,'gi'),QR[i]);}
return RegExp(re,'i');}
function _print(value){let html='';if(value){const regex=getRegExp(value);data.forEach(row=>{if(row[1].search(regex)!=-1){html+='<li><a href="'+row[2]+'"><i class="'+types[row[0]]+' color-light"></i>'+row[1]+'</a></li>';}});}
if(html){html='<div class="dropdown-menu"><ul>'+html+'</ul></div>';dd.innerHTML=html;}else{dd.innerHTML='';}}
el.addEventListener('input',function(){if(status===0){status=1;JsRequest.json({url:JsUrl('admin/backend/menus'),onSuccess:function(json){data=json;_print(el.value);status=2;}});}else if(status==2){_print(el.value);}});});Backend.attach('thirdbar',function(bar){(document.querySelectorAll('.widget-thirdbar ul > li > a')||[]).forEach(function($btn){const $menu=$btn.nextSibling&&$btn.nextSibling.tagName==='UL'?$btn.nextSibling:null;if($menu){$btn.setAttribute('aria-expanded',false);$btn.addEventListener('click',function(event){event.preventDefault();event.stopPropagation();JsDropdown($menu,{onToggle:function(status){$menu.classList.toggle('active',status);$btn.setAttribute('aria-expanded',status);},}).toggle();});}});});Backend.attachAll({notifications:function(el){JsNotifications.load(el);el.addEventListener('click',function(){JsNotifications.show();});},logout:function(el){el.addEventListener('click',function(){UsysLogout();});},theme:JsTheme,color:function(el){ThemeColor.set(el);}});const ThemeColor=(function(){return{set:function($btn){const header=document.querySelector('.layout-header');const colors=['default','primary','secondary','info','success','warning','danger'];function set(color){colors.forEach((c)=>header.classList.toggle(`header-${c}`,c==color));JsCookie.set(header.dataset.tck,color);}
$btn.parentNode.querySelectorAll('[data-value]').forEach(function($el){const color=$el.getAttribute('data-value');$el.addEventListener('click',function(){document.body.click();set(color);});});}};})();function UsysLogout(){JsDropdown.hide();JsRequest.modal({url:JsUrl('/usys/logout'),modalOptions:{onLoad:function(){JsForm('logout',{btn:this}).request(JsUrl('/usys/take_logout'),function(){window.location.reload();});}}});}
const JsNotifications=(function(){const key='notifications';return{show:function(){localStorage.removeItem(key);JsRequest.text({url:JsUrl('my/notifications/show'),onSuccess:function(html){let el=document.querySelector('[control-tpl=notifications] span');if(el){el.parentNode.removeChild(el);}
Lightbox({valignCenter:false}).setContent(html);},})},load:function(el){const lifetime=minutes(20);const badge=el.querySelector('span');function minutes(total){return total*(60*1000);}
function show(total){total=parseInt(total);if(total){badge.textContent=total;}
badge.style.display=total?'':'none';}
function get(){let data=localStorage.getItem(key);if(!data){return null;}
data=JSON.parse(data);return data&&(data.createdAt+lifetime)>Date.now()?data:null;}
function request(){JsRequest.json({url:JsUrl('my/notifications/data'),spinner:false,onSuccess:function(json){json.createdAt=Date.now();localStorage.setItem(key,JSON.stringify(json));show(json.total);}});}
const data=get(key);if(data){show(data.total);}else{request();}}};})();