var JsOptions=(function(){var _options={};return function(key){if(_options[key]===undefined){_options[key]={};}
return{get:function(defaultOptions){if(typeof defaultOptions=='object'){_options[key]=Object.assign({},defaultOptions,_options[key]);}
return _options[key];},set:function(options){if(typeof options=='object'){for(var i in options){_options[key][i]=options[i];}}}};};})();function JsMergeOptions(base,options,force){options=Object.assign(base,options,force);var events={};for(var i in options){if(i.substring(0,2)=='on'&&typeof options[i]=='function'){events[i.substring(2).toLowerCase()]=options[i];delete options[i];}}
options.fire=function(name,scope,...args){if(events[name]){return events[name].apply(scope,...args);}}
return options;}
function Iterable(elements){if(!elements){return[];}else if(elements.nodeType==1){elements=[elements];}else{switch(Object.prototype.toString.call(elements).slice(8,-1)){case'Object':case'HTMLCollection':case'NodeList':let i=elements.length||0;let a=new Array(i);while(i--){a[i]=elements[i];}
elements=a;case'Array':break;default:return[];}}
return elements;}
var JsControls=function(controls){controls=Object.assign({},controls);return{attach:function(handle,name,fn){controls[handle][name]=fn;return this;},attachAll:function(handle,obj){if(typeof controls[handle]!='object'){controls[handle]={};}
for(let name in obj){controls[handle][name]=obj[name];}
return this;},load:function(handle,box,fn){let attr='control-'+handle;if(typeof fn!='function'){fn=function(el,fn,name){fn(el,name);};}
Array.from(box.querySelectorAll('['+attr+']')).forEach(function(el){let name=el.getAttribute(attr)||'default';if(controls[handle][name]){fn(el,controls[handle][name],name);}});return this;},};};var JsCookie=(function(){function set(key,value,attr){let cookie=key+'='+decodeURIComponent(value);attr=Object.assign({path:'/',expires:365},attr);if(typeof attr.expires==='number'){attr.expires=new Date(Date.now()+attr.expires*864e5);}
if(attr.expires){attr.expires=attr.expires.toUTCString();}
for(let name in attr){if(attr[name]){cookie+='; '+name;if(attr[name]!==true){cookie+='='+attr[name].split(';')[0];}}}
return(window.top.document.cookie=cookie);}
function get(key){let match=window.top.document.cookie.match(key+'=([^;]*)');if(!match){return'';}
let value=match[1];if(value[0]==='"'){value=value.slice(1,-1);}
return decodeURIComponent(value);}
return Object.create({set:set,get:get,remove:function(key,attr){set(key,'',Object.assign({},attr,{expires:-1}));}});})();const JsDropdown=(function(){let current;let that;return function(el,options){if(typeof el==='string'){el=document.querySelector(el);}
if(!el){if(that){that.hide();}
return;}
if(el==current){return that;}else if(that){that.hide();}
options=Object.assign({onToggle:null,onShow:null,onHide:null},options);current=el;that={show:function(){that.toggle(true);},hide:function(){that.toggle(false);},toggle:function(status){if(!current){return;}
if(typeof status=='undefined'){status=window.getComputedStyle(current)['display']=='none';}
function fn(evName,displayValue,fireEvents){document[evName]('click',that.hide);current[evName]('click',function(event){event.stopPropagation();});current.style.display=displayValue;fireEvents.forEach(function(fireEvent){if(typeof options[fireEvent]=='function'){options[fireEvent](status);}});}
if(status){fn('addEventListener','',['onToggle','onShow']);}else{fn('removeEventListener','none',['onToggle','onHide']);current=that=null;}}};return that;};})();JsDropdown.hide=function(){JsDropdown(false);};function JsElement(el,options){function setAttribute(attrName,attrValue){switch(attrName){case'styles':for(let j in attrValue){el.style[j]=attrValue[j];}
break;case'events':for(let j in attrValue){j.split(' ').forEach(function(eventName){el.addEventListener(eventName,attrValue[j]);});}
break;case'html':el.innerHTML=attrValue;break;case'text':el.textContent=attrValue;break;case'class':case'className':el.className=attrValue;break;case'multiple':el.multiple=attrValue;break;default:if(typeof attrValue=='function'){el[attrName]=attrValue;}else{el.setAttribute(attrName,attrValue);}
break;}}
function cleanTagName(tag){if(tag.indexOf('.')>-1){[tag,options.className]=tag.split('.');if(options.className.indexOf('#')>-1){[options.className,options.id]=tag.split('#');}}
if(tag.indexOf('#')>-1){[tag,options.id]=tag.split('#');}
return tag.toUpperCase();}
if(typeof options!='object'){options={};}
if(typeof el=='string'){el=document.createElement(cleanTagName(el));}
for(let i in options){setAttribute(i,options[i]);}
return el;}
var JsForm=function(form,options={}){if(typeof form=='object'&&form.tagName!='FORM'){options=form;form='';}
if(!form||typeof form=='number'){form=document.querySelector('#js-form'+(form||''));}else if(typeof form=='string'){try{form=document.querySelector(form)||document.querySelector('#'+form+'-form');}catch(e){}}
if(!form||form.tagName!='FORM'){return;}
options=Object.assign({focusable:true},options);var btn=options.btn;function focus(){function fn(types,checkables=[],tags=[]){for(let el,i=0;el=form.elements[i];i++){if(el.name&&!el.disabled){if(tags.includes(el.tagName)||types.includes(el.type)||(checkables.includes(el.type)&&el.checked)){return el;}}}}
let el=fn(['text','number','password','url','email','date'],['checkbox','radio'],['SELECT','TEXTAREA'])||fn(['submit'])||fn(['button']);if(el){el.focus();}}
var $U;var _data=[];var _controls=JsControls({form:{}});var that={url:function(fn){if(typeof fn=='function'){$U=fn;}
return this;},controls:function(options){for(var ctrlName in options){switch(typeof options[ctrlName]){case'object':options[ctrlName]=(function(options,ctrlName){var load=options.load||'xjs';if(typeof options.modalOptions=='object'&&load!='modal'){load='modal';}
if(!options.url&&$U){options.url=$U(ctrlName);}
return function(el){if(typeof options.onSubmit=='function'&&!options.onSubmit(el)){return;}
var data=[];var value=el.getAttribute('data-value');if(typeof value!='undefined'){data.push({[ctrlName]:value});}
switch(typeof options.data){case'function':case'string':case'object':data.push(options.data);break;}
JsRequest[load](Object.assign({},options,{data:data}));};})(options[ctrlName],ctrlName);case'function':_controls.attach('form',ctrlName,options[ctrlName]);break;}}
_controls.load('form',form,function(el,fn){var eventName='click';if(el.nodeName=='SELECT'||(el.type&&['checkbox','radio'].indexOf(el.type)!=-1)){eventName='change';}else if(el.nodeName=='INPUT'){eventName='blur';}
el.addEventListener(eventName,function(event){event.preventDefault();event.stopPropagation();document.body.click();fn(el);});});return this;},request:function(options,callback,load){switch(typeof options){case'function':this.submit=options;break;case'string':options={url:options};case'object':var options_data=options.data;var isArray=Array.isArray(options_data);if(typeof options.modalOptions=='object'){load='modal';}else if(typeof options.load!='undefined'&&typeof options.load){load=options.load;}else if(!load){load='xjs';}
if(typeof callback=='function'){options.onSuccess=callback;}
if(typeof options.onReset=='function'){form.addEventListener('reset',function(event){options.onReset.call(form,event);});}
this.submit=function(){if(typeof options.onSubmit=='function'&&!options.onSubmit(form)){return;}
if(typeof options.spinner=='undefined'){options.spinner={disable:this.getSubmit()};}
var data=this.getData();if(options_data){if(!Array.isArray(data)){data=[data];}
if(isArray){data.concat(options_data);}else{data.push(options_data);}}
options.data=data;JsRequest[load](options);};break;}
return this;},getData:function(){return _data.length?[form,_data]:form;},getForm:function(name){if(name){return typeof form[name]!='undefined'?form[name].value:undefined;}
return form;},getSubmit:function(){if(!btn){btn=form.querySelector('*[type=submit]');}
return btn;},reset:function(){form.reset();},notify:function(options){JsNotify.creator(form).notify(options);},};switch(typeof btn){case'object':if(btn.isModal){btn=btn.getSubmit();}
break;case'string':btn=document.querySelector(btn);break;}
if(btn){btn.setAttribute('form',form);if(!btn.form){btn.addEventListener('click',function(){that.submit();});}}
JsFelem.load(form,_data);JsControls({form:{'toggle-body':function(el){for(var box=el;!box.classList.contains('form-fieldset');box=box.parentNode){if(box.tagName=='BODY'){return;}}
el.addEventListener('click',function(){el.setAttribute('aria-expanded',box.classList.toggle('expanded'));});},}}).load('form',form);form.addEventListener('submit',function(event){event.preventDefault();that.submit();});if(options.focusable){focus();}
return that;};var JsHistory=function(stateKey,fn,stateValue){var
w=window.top,h=w.history,d=w.document,l=d.location,state=h.state||{};_value=stateValue!==undefined?stateValue:l.href;state[stateKey]=_value;h.replaceState(state,d.title,l.href);window.addEventListener('popstate',function(event){var v=event.state[stateKey];if(_value!=v){_value=v;fn(event);}});return{push:function(title,url,value){if(typeof value=='function'){value=value(h.state[stateKey]);}else if(!value){value=url;}
h.state[stateKey]=_value=value;h.pushState(h.state,title||'',url);},};};JsHistory.check=function(){return(history&&history.pushState);};let JsImport=(function(){let promises={};let head=document.querySelector('head');function i(resources){if(typeof resources==='string'){return resources.split(',').map(value=>value.trim());}
return resources?Array.isArray(resources):[];}
function getExtension(f){return f.substr(f.lastIndexOf('.')+1);}
function getElementPromise(tagName,attr,resource){return new Promise((resolve,reject)=>{let el=head.appendChild(document.createElement(tagName));el.onload=function(){promises[resource].complete=true;resolve();};el.onerror=function(){reject();};for(let attrName in attr){el[attrName]=attr[attrName];}});}
return function(resources){let All=[];i(resources).forEach(function(resource){if(typeof promises[resource]=='object'){All.push(promises[resource].complete?Promise.resolve():promises[resource].promise);}else{const extension=getExtension(resource);if(['js','css'].indexOf(extension)==-1){return;}
const promise=(extension==='js')?getElementPromise('script',{async:true,src:resource},resource):getElementPromise('link',{type:'text/css',rel:'stylesheet',href:resource},resource);All.push(promise);promises[resource]={complete:false,promise:promise};}});return Promise.all(All);};})();function Lightbox(options){options=Object.assign({iniVisible:true,hideWithButton:true,hideWithOverlay:true,valignCenter:true,},options);const body=document.body;const overlay=body.appendChild(JsElement('div.lightbox',{html:'<div></div>'}));const box=overlay.firstChild;const that={remnove:function(){overlay.parentNode.removeChild(overlay);body.classList.remove('lightbox-fixed');},toggle:function(force){const status=body.classList.toggle('lightbox-fixed',force);overlay.style.display=status?'':'none';return status;},show:function(){this.toggle(true);},hide:function(){this.toggle(false);},getContainer:function(){return box;},setContent:function(content){if(typeof content==='string'){box.innerHTML=content;}else{box.innerHTML='';box.appendChild(content);}
return this;}};if(options.valignCenter){overlay.classList.add('valign-center');}
if(options.hideWithButton){overlay.appendChild(JsElement('i.fa-solid fa-xmark lightbox-cross')).addEventListener('click',function(event){event.stopPropagation();that.hide();});}
if(options.hideWithOverlay){overlay.addEventListener('click',function(event){event.stopPropagation();that.hide();});box.addEventListener('click',function(event){event.stopPropagation();});}
that.toggle(options.iniVisible);return that;};function JsLoading(force){let ID='js-loading';let doc=window.self.document;(doc.getElementById(ID)||doc.body.appendChild(JsElement('div',{id:ID,className:ID}))).style.display=force?'':'none';};var JsMove=function(el,startFn,moveFn,endFn){function setClient(event){var e=event;switch(event.type){case'touchstart':e=event.touches[0];break;case'touchmove':case'touchend':e=event.changedTouches[0];break;}
if(e.clientX||e.clientY){if(e!==event){event.clientX=e.clientX;event.clientY=e.clientY;}}else if(e.pageX||e.pageY){event.clientX=e.pageX-document.body.scrollLeft-document.documentElement.scrollLeft;event.clientY=e.pageY-document.body.scrollTop-document.documentElement.scrollTop;}};function setEvent(el,eventNames,fn,force){eventNames.split(' ').forEach(function(eventName){el[(force?'add':'remove')+'EventListener'](eventName,fn);});};function activate(force){setEvent(document,'mousemove touchmove',_moveFn,force);setEvent(document,'mouseup touchend',_endFn,force);};function _startFn(event){setClient(event);startFn(event);activate(true);};function _moveFn(event){setClient(event);moveFn(event);};function _endFn(event){if(typeof endFn=='function'){setClient(event);endFn(event);}
activate(false);};setEvent(el,'mousedown touchstart',_startFn,true);};var JsNotify=(function(){var current;var notify=function(options){var handler;var _hits=0;function clear(){options.target.innerHTML='';current=null;}
function hit(){hide(1);}
function hide(hits,already){if(!(options.maxTime>0)){return;}
_hits+=hits;if(_hits>100){document.removeEventListener('click',hit);handler=clearTimeout(handler);if(already){clear();}else{handler=setTimeout(clear,1000);}}else if(_hits==100){handler=setTimeout(hit,options.maxTime*1000);}}
options=Object.assign({message:'',class:'',maxTime:42,minTime:8,target:null,},options);if(typeof options.target=='string'){options.target=document.querySelector(options.target);}
if(typeof options.target!='object'){alert(options.message);}
options.target.innerHTML='<span><span'
+(options['class']?' class="'+options['class']+'"':'')+'>'
+options.message
+'</span></span>';if(options.maxTime){document.addEventListener('click',hit);handler=setTimeout(function(){hide(100);},options.minTime*1000);}
return{hide:function(){hide(101,true);}};};return function(options){if(current!=null){current.hide();}
if(options){current=notify(options);}};})();JsNotify.hide=function(){JsNotify(false);};JsNotify.creator=function(object,before){if(typeof object.notify!='function'){if(!before){before=object;}
var _target=before.parentNode.insertBefore(JsElement('div.notify-box',{role:'alert'}),before);object.notify=function(options){if(typeof options=='string'){options={'message':options};}
options.target=_target;JsNotify(options);};}
return object;};const JsRequest=(function(){function getType(value){let type=typeof value;if(type!='object'){return type;}
type=Object.prototype.toString.call(value).slice(8,-1);if(type.slice(0,4)=='HTML'){type=type.slice(4,-7);}
return type.toLowerCase();}
function toQueryArray(data,esc){let _data=[];switch(getType(data)){case'string':data.replace(/([^?=&]+)(=([^&]*))?/g,function($0,$1,$2,$3){_data.push([$1,$3]);});break;case'array':if(esc){data.forEach(function(item){_data.push(item);});}else{data.forEach(function(items){items=toQueryArray(items,true);if(items.length){Array.prototype.push.apply(_data,items);}});}
break;case'object':for(let i in data){_data.push([i,data[i]]);}
break;case'function':return toQueryArray(data());case'input':case'textarea':case'select':case'button':data={elements:[data]};case'form':let el;for(let i=0;el=data.elements[i];i++){if(el.name&&!el.disabled&&['file','reset'].indexOf(el.type)==-1){if(el.type=='select-multiple'){let m=el.options.length;for(let j=0;j<m;j++){if(el.options[j].selected){_data.push([el.name,el.options[j].value]);}}}else if(['checkbox','radio'].indexOf(el.type)==-1||el.checked){_data.push([el.name,el.value]);}}}
break;}
return _data;}
function toQueryString(data){data=toQueryArray(data);if(!data){return'';}
return data.map(function(a){return encodeURIComponent(a[0])+'='+encodeURIComponent(a[1])}).join('&').replace(/%20/g,'+');}
function toFormData(data){if(getType(data)=='form'){return new FormData(data);}
const fd=getFormData(data);toQueryArray(data).forEach((dataItem)=>{switch(dataItem.length){case 2:fd.append(dataItem[0],dataItem[1]);break;case 3:fd.append(dataItem[0],dataItem[1],dataItem[2]);break;}});return fd;}
function getFormData(data){let f,fd;if(getType(data)=='array'){const L=data.length;for(let i=0;i<L&&!f&&!fd;i++){switch(getType(data[i])){case'form':f=data[i];data.splice(i,1);break;case'formdata':fd=data[i];data.splice(i,1);break;}}}
return fd||new FormData(f);}
function toURLGet(url,data){return url+(url.indexOf('?')==-1?'?':'&')+toQueryString(data);}
function parseUrlData(url){if(url.indexOf('?')==-1){return[];}
let data=[];let a=url.split('?')[1].split('&');for(let i in a){data.push(a[i].split('=').map(function(comp){return decodeURIComponent(comp);}));}
return data;}
function $(e){return typeof e=='string'?document.querySelector(e):e;}
function onlineToast(){JsToast({message:'Online',type:'success'});}
function offlineToast(){JsToast({message:'Offline',type:'danger'});}
var online=window.navigator.onLine;var offline_displayed=false;window.addEventListener('offline',function(event){online=false;});window.addEventListener('online',function(event){online=true;if(offline_displayed){offline_displayed=false;onlineToast();}});return{mergeData:function(){let data=[];for(let i=0;i<arguments.length;i++){if(Array.isArray(arguments[i])){for(let j=0;j<arguments[i].length;j++){data.push(arguments[i][j]);}}else if(typeof arguments[i]!='undefined'){data.push(arguments[i]);}}
return data;},implement:function(obj){for(let i in obj){if(typeof obj[i]=='function'&&!this[i]){this[i]=obj[i];}}},load:function(options){let load=options.load||'text';if(['mergeData','implement','load'].indexOf(load)==-1&&typeof this[load]=='function'){this[load](options);}},link:function(options,forceOptions){options=Object.assign({},options,forceOptions);const el=document.body.appendChild(JsElement('a',{href:toURLGet(options.url,options.data),target:(options.target||'_self'),styles:{display:'none'}}));el.click();document.body.removeChild(el);},http:function(options,forceOptions){options=Object.assign({},options,forceOptions);var data=parseUrlData(options.url);if(getType(options.data)=='form'){var f=options.data;}else{var f=document.body.appendChild(JsElement('form'));data=data.concat(toQueryArray(options.data));}
data.forEach(function(d){f.appendChild(JsElement('input',{type:'hidden',name:d[0],value:d[1],}));});f.action=options.url;f.method=options.method;f.submit();if(typeof options.onSuccess=='function'){options.onSuccess();}},ajax:function(options,forceOptions){if(!online){if(!offline_displayed){offline_displayed=true;offlineToast();}}
options=Object.assign({},options,forceOptions);if(options.update){const el=$(options.update);delete options.update;options.onSuccess=function(html){el.innerHTML=html;};}
let data=getType(options.data)=='array'?options.data:[options.data];let fetchOptions={};if(options.spinner!==false){if(typeof spinner!='function'){options.spinner=JsLoading;}
options.spinner(true);}
if(typeof options.format!='undefined'){options.headers??={};if(options.responseType=='json'){options.headers['Accept']='application/json';}
options.url=toURLGet(options.url,{format:options.format});}
if(options.method=='GET'){options.url=toURLGet(options.url,data);}else{if(options.method&&options.method!='POST'){data.push({__method:options.method.toUpperCase()});}
fetchOptions.method='POST';fetchOptions.body=toFormData(data);}
['cache','credentials','headers','integrity','mode','redirect','referrer','referrerPolicy'].forEach(function(prop){if(typeof options[prop]!='undefined'){fetchOptions[prop]=options[prop];}});fetch(options.url,fetchOptions).then(function(response){if(options.spinner){options.spinner(false);}
return response[options.responseType]();}).then(function(data){switch(options.responseType){case'json':if(data.__error){throw new Error(data.__error);}
if(data.__alert){Modal(data.__alert);}
if(data.__profiler){JsConsole.log(data.__profiler);}
break;case'text':let log=JsConsole.getTextData(data);if(log){JsConsole.log(log);}
break;}
return data;}).then(function(data){if(typeof options.onSuccess=='function'){options.onSuccess.call(options,data);}}).catch(function(e){JsToast({message:`${e.name}: ${e.message}.`,type:'danger'});});},};})();JsRequest.implement({blank:function(options){return this.link(options,{target:'_blank'});},get:function(options){return this.http(options,{method:'GET'});},post:function(options){return this.http(options,{method:'POST'});},text:function(options){return this.ajax(options,{format:'text',responseType:'text',});},json:function(options){return this.ajax(options,{format:'json',responseType:'json',update:false,});},});var JsToast=(function(){var box;return function(options){if(typeof options=='string'){options={message:options};}
options=Object.assign({message:'',type:'',displayLength:8},options);if(!box){box=document.body.appendChild(JsElement('div.toast-container'));}
var toast=box.appendChild(JsElement('div',{html:'<div class="toast-body">'+options.message+'</div><div class="toast-close" data-toast="close"><i class="fa-solid fa-xmark"></i></div>',className:'toast'+(options.type?' toast-'+options.type:''),role:'alert',close:function(){box.removeChild(this);if(!box.firstChild){box.parentNode.removeChild(box);box=null;}
handler=false;}}));toast.querySelector('[data-toast=close]').addEventListener('click',function(){toast.close();});if(options.displayLength){var handler=setTimeout(function(){if(handler){toast.close();}},options.displayLength*1000)}
return toast;};})();const Tooltip=function(box){box=(box||document);const tt=(el)=>{let tooltip,parent,status;let content=el.getAttribute('data-value');if(content===null){content=el.title;el.title='';}
if(!content){return;}
if(content.charAt(0)=='#'){tooltip=box.querySelector(content);}
if(tooltip){for(parent=tooltip.parentNode;parent&&window.getComputedStyle(parent).position!='relative';parent=parent.parentNode==document.body?false:parent.parentNode);}else{tooltip=document.body.appendChild(JsElement('div.tooltip',{'html':content}));}
let position='top';let delay=0;el.getAttribute('data-tooltip').split(' ').forEach((cmd)=>{if(cmd=='blocked'){delay=100;}else if(['bottom','right','left'].indexOf(cmd)>-1){position=cmd;tooltip.classList.add(cmd);}});tooltip.toggle=function(force){switch(force){case 2:if(!status){status=1;}
case 1:if(status){return;}
status=1;break;case 0:status=0;if(delay){return setTimeout(()=>{tooltip.toggle(-1)},delay);}
break;case-1:if(status){return;}
case-2:force=0;break;}
if(force){let top,left;let rectA=el.getBoundingClientRect();let rectB=tooltip.getBoundingClientRect();let rectC=parent?parent.getBoundingClientRect():{top:-document.documentElement.scrollTop,left:-document.documentElement.scrollLeft};switch(position){case'top':top=(rectA.top-rectB.height-5);break;case'bottom':top=(rectA.top+rectA.height+5);break;case'right':left=(rectA.left+rectA.width+5);break;case'left':left=(rectA.left-rectB.width-5);break;}
if(!top){top=rectA.top+rectA.height/2-rectB.height/2;}else if(!left){left=rectA.left+rectA.width/2-rectB.width/2;}
tooltip.style.top=top-rectC.top+'px';tooltip.style.left=left-rectC.left+'px';TooltipActive.add(this);}
this.classList.toggle('show',force);};const events=(el,statuses)=>{statuses.forEach((status,i)=>{el.addEventListener(['mouseout','mouseover','focus','blur'][i],()=>{tooltip.toggle(status);});});}
events(el,[0,1,1,0]);if(delay){events(tooltip,[0,2]);}};Array.from(box.querySelectorAll('[data-tooltip]')).forEach(tt);};const TooltipActive=(function(){let current;return{add:function(el){this.hide();current=el;},hide:function(el){if(current){current.toggle(-2);}},};})();const JsFelem=(function(){const _observe={};const _felem={submit:function(el){el.addEventListener(el.getAttribute('data-value')||'click',function(){JsFelem.submit(el);});}};const that={implement:function(handles){for(let handle in handles){if(typeof handles[handle]=='function'){_felem[handle]=handles[handle];}}},observe:function(handles){for(let handle in handles){if(typeof handles[handle]=='function'){_observe[handle]=handles[handle];}}},load:function(box,data){if(!box){box=document;}else if(typeof box==='string'){box=document.querySelector(box);}
Array.from(box.querySelectorAll('*[control-felem]')).forEach(function(el){el.getAttribute('control-felem').split(' ').forEach(function(handle){if(handle&&typeof _felem[handle]=='function'){_felem[handle](el,box,data);}});});function observeFn(all,fn){all.forEach(function(el){fn(el,box,data);});}
for(let i in _observe){observeFn(Array.from(box.querySelectorAll(i)),_observe[i]);}},submit:function(form){for(;form.tagName!='FORM';form=form.parentNode){if(form.tagName=='BODY'){return;}}
let btn=form.querySelector('*[type="submit"]');if(btn){btn.click();}else{btn=form.appendChild(document.createElement('input'));btn.type='submit';btn.style.display='none';btn.click();form.removeChild(btn);}},};return that;})();JsFelem.implement({'check-all':function(checkall,form){const name=checkall.getAttribute('data-checkall');const elements=form.querySelectorAll('[name="'+name+'[]"]');function areAllChecked(){let i=elements.length
while(i--){if(!elements[i].checked){return false;}}
return true;}
function fn(){if(checkall.checked!=areAllChecked()){checkall.locked=true;checkall.parentNode.click();}}
checkall.addEventListener('change',function(){if(checkall.locked){checkall.locked=false;}else{elements.forEach(function(el){if(el.checked!=checkall.checked){el.locked=true;el.parentNode.click();}});}});elements.forEach(function(el){el.addEventListener('change',function(){if(el.locked){el.locked=false;}else{fn();}});});fn();}});function JsColor(el){if(el.tagName!='INPUT'){return;}
let btn=JsElement('input',{type:'color',value:el.value,className:'input-field input-color',events:{change:function(){el.value=btn.value;}}});el.type='text';el.addEventListener('input',function(){btn.value=el.value;});let group=el.parentNode.insertBefore(JsElement('div.input-group'),el);group.appendChild(el)
group.appendChild(btn);}
JsFelem.implement({'color':function(el,box){JsColor(el);}});(function(){function dropdown(el){let isSelect=el.getAttribute('control-felem')=='select';let hasSubmit=el.getAttribute('data-on-change')=='submit';let isSimple=el.className!='btn-group';let box=isSimple?el.parentNode:el;let btn=isSimple?el:(el.querySelector('[role=caret]')||el.querySelector('.dropdown-toggle'));let menu=(box.querySelector('[role=drop-menu]')||box.querySelector('.dropdown-menu'));function fn(event){event.stopPropagation();JsDropdown(menu,{onToggle:function(status){el.classList.toggle('active',status);btn.setAttribute('aria-expanded',status);if(status){let rect=menu.getBoundingClientRect();if(rect.right>window.innerWidth){menu.style.right='-1px';menu.style.left='auto';}else if(rect.left<0){menu.style.right='auto';menu.style.left='0px';}}},}).toggle();}
btn.addEventListener('click',fn);btn.setAttribute('aria-expanded',false);if(isSimple){menu.style.left=(el.getBoundingClientRect().left-el.parentNode.getBoundingClientRect().left)+'px';}else{menu.style.right='-1px';}
if(isSelect){let label=isSimple?el:el.querySelector('[data-select-label]');if(label){let hidden=menu.querySelector('input[type=hidden]');let all=Array.from(menu.getElementsByTagName('LI'));all.forEach(function(el){el.addEventListener('click',function(event){event.stopPropagation();all.forEach(function(el2){el2.className=(el2==el?'selected':'');});JsDropdown.hide();label.innerHTML=el.textContent;hidden.value=el.getAttribute('data-select-value');if(hasSubmit){JsFelem.submit(hidden.form);}});});}}};JsFelem.implement({'select':dropdown,'dropdown':dropdown});})();JsFelem.implement({password:function(el,box){if(el.tagName=='INPUT'){let btn=JsElement('div.btn',{html:'<i class="fa-solid fa-eye"></i>',events:{click:function(){let status=el.type=='password';el.type=status?'text':'password';btn.firstChild.className=status?'fa-solid fa-eye-slash':'fa-solid fa-eye';}}});let group=el.parentNode.insertBefore(JsElement('div.input-group'),el);group.appendChild(el)
group.appendChild(btn);}}});JsFelem.implement({'press':function(el,box){let input=el.querySelector('input');if(input){let all=(input.type=='radio')?Array.from(box.querySelectorAll('input[type=radio][name='+input.name+']')):[input];input.addEventListener('change',function(){all.forEach(function(el){el.parentNode.classList[el.checked?'add':'remove']('checked');});});}}});var FeTextarea={'max-chars':function(el){var max=el.getAttribute('data-max-chars');var div=el.parentNode.insertBefore(JsElement('div.color-light'),el.nextSibling);var fn=function(event){var total=max-el.value.length;if(total<0){event.preventDefault();el.value=el.value.substring(0,max);total='<span class="color-danger">0</span>';}
div.innerHTML=total;};if(max){el.addEventListener('keydown',fn);if('oninput'in el){el.addEventListener('input',fn);}
fn();}},'auto-grow':function(el){if('field-sizing'in document.body.style){return;}
const maxHeight=parseInt(el.getAttribute('data-max-height'));const minHeight=parseInt(el.getAttribute('data-min-height')||window.getComputedStyle(el).getPropertyValue('height'))||30;function fn(){el.style.height='0';el.style.height=Math.max(parseInt(maxHeight?Math.min(el.scrollHeight,maxHeight):el.scrollHeight),minHeight)+'px';}
el.style.overflow='hidden';el.style.wordWrap='break-word';el.style.resize='none';el.addEventListener('oninput'in el?'input':'keyup',fn);el.autoGrow=fn;fn();},};JsFelem.implement(FeTextarea);var Modal=function(options){options=JsMergeOptions({target:undefined,overlay:true,draggable:false,destroy:true,type:'default',size:'medium',title:'',icon:'',help_url:null,help_title:null,content:null,buttons:[],form:null,footer_html:'',},options);let controls=JsControls({modal:{close:function(){that.close()},hide:function(){that.hide()}},});let curFocus;let that={isModal:1,close:function(){if(element.parentNode){if(options.fire('close',that)===false){return that;}
toggleFix(false);that.blur();if(options.destroy){element.parentNode.removeChild(element);}else{that.hide();}}
return false;},show:function(){this.toggle(true);},hide:function(){this.toggle(false);},toggle:function(status){if(typeof status=='undefined'){status=element.style.display=='none';}
if(status){this.focus();}else{this.blur();}
element.style.display=status?'':'none';},focus:function(){if(!getFocusableElements().includes(document.activeElement)){curFocus=document.activeElement;}
options.target?.blur();element.querySelector('button[control-modal=close]')?.focus();if(options.overlay){element.scroll(0,0);}
document.addEventListener('keydown',keyboardControls);},blur:function(){options.target?.focus();curFocus?.focus();document.removeEventListener('keydown',keyboardControls);},getSubmit:function(){return element.querySelector('.modal-footer *[type=submit]');},getElement:function(selector){if(selector){return _element.querySelector(selector);}
return _element;}};function getFocusableElements(){return[..._element.querySelectorAll('a[href],button,input,textarea,select,details,[tabindex]:not([tabindex="-1"])')].filter(el=>!el.hasAttribute('disabled')&&!el.getAttribute('aria-hidden'));}
function keyboardControls(event){if(!element){that.blur();}
if(event.key=='Tab'){let focusables=getFocusableElements();let length=focusables.length;if(!length){event.preventDefault();}else if(!focusables.includes(document.activeElement)){event.preventDefault();focusables[0].focus();}else{let isBack=event.shiftKey;if(isBack){if(document.activeElement==focusables[0]){event.preventDefault();focusables[length-1].focus();}}else if(document.activeElement==focusables[length-1]){event.preventDefault();focusables[0].focus();}}}else if(event.key=='Escape'){that.close();}}
function getButtonClass(button){let css=['btn'];if(button.class){css.push(button.class);}
if(button.type=='submit'){css.push('btn-primary btn-solid');}
return css.join(' ');}
function render(number){let header='';let footer='';if(options.title){if(options.icon){header+='<div><i class="'+options.icon+'" aria-hidden="true"></i></div>';}
header+='<div id="modal-'+number+'-title" class="modal-title"><h3>'+options.title+'<h3></div>';if(options.help_url){header+='<div><a href="'+options.help_url+'" target="_blank" title="'+options.help_title+'"><i class="fa-solid fa-circle-question"></i></a></div>';}
header='<div class="modal-header">'+header+'</div>';}
if(options.buttons.length){let x={'help':'','button':'','submit':'','close':''};options.buttons.forEach(function(button){x[button.type]+='<button type="'+(button.type=='submit'?'submit':'button')+'"'
+(button.type!='submit'?' control-modal="'+(button.control||button.type)+'"':'')
+' class="'+getButtonClass(button)+'">'
+button.caption
+'</button>';});footer='<div class="modal-footer">'+options.footer_html+x.help+x.button+x.submit+x.close+'</div>';}
if(options.form){if(Array.isArray(options.form.hidden)){options.form.hidden.forEach(function(hidden){footer+='<input type="hidden" name="'+hidden.name+'" value="'+hidden.value+'"/>';});}
footer='<form id="'+options.form.id+'">'+footer+'</form>';}
return'<div class="modal modal-'+options.type+'" tabindex="-1" role="dialog" aria-modal="true" aria-labeledby="modal-'+number+'-title"><div>'
+header
+'<div class="modal-body">'+(options.content||'')+'</div>'
+footer
+'</div></div>';}
function toggleFix(force){if(options.overlay&&element.parentNode==document.body){if(Modal.countFixed==0||Modal.countFixed==1){document.body.classList.toggle('modal-fixed',force);document.body.style.width=force?document.body.clientWidth+'px':'';}
Modal.countFixed+=(force?1:-1);}}
if(options.type=='alert'){options.size='small';}
var _element=element=JsElement('div.modal-'+options.size,{html:render(Modal.countFixed),'data-modal':1,});if(options.draggable){let handle=element.querySelector('.modal-header');let initial;function startFn(event){event.stopPropagation();event.preventDefault();let rect=element.getBoundingClientRect();initial={x:rect.left-event.clientX,y:rect.top-event.clientY,};}
function moveFn(event){element.style.left=(initial.x+event.clientX)+'px';element.style.top=(initial.y+event.clientY)+'px';element.style.margin='0px';}
handle.style.cursor='move';JsMove(handle,startFn,moveFn);}else if(options.overlay){var element=JsElement('div.modal-overlay');element.appendChild(_element);element.addEventListener('click',that.close);_element.addEventListener('click',function(event){event.stopPropagation();JsDropdown.hide();});}
controls.load('modal',element,function(el,fn){el.addEventListener('click',fn);});let parent=document.body;if(typeof options.target=='object'){if(options.target.isModal){parent=options.target.getElement();}else{parent=options.target;}}
parent.appendChild(element);toggleFix(true);that.show();options.fire('load',that);JsNotify.hide();JsNotify.creator(that,element.querySelector('.modal-body'));return that;};Modal.countFixed=0;JsRequest.implement({modal:function(options){var mo=typeof options.modalOptions=='object'?options.modalOptions:null;return this.ajax(options,{format:'modal',responseType:'json',update:false,onSuccess:function(json){Modal(Object.assign({},mo,json));},});},});var JsConsole=(function(){function $U(args){return JsUrl('/profiler',args,'blank');}
var cookieName='JsConsole';var options={mode:0,};var _window;var _tails=[];function consolePopup(report){if(!_window||_window.closed){try{_window=window.open('','profiler-console','width=580,height=480,toolbar=no,scrollbars=no,top=500,left=500');if(_window.location=='about:blank'){_window.location=$U();}}catch(e){alert('The navigator lockout the popup! '+e);return;}}
if(typeof _window.JsConsole=='object'){_window.JsConsole.log(report);}else{_tails.push(report);}}
function consoleFrame(report){if(window.top==window.self){window.stop();window.location=$U({frame:window.location.href});}else{_window=window.parent;_window.JsConsole.log(report);_window.history.replaceState({path:window.self.location.href},window.self.document.title,window.self.location.href);}}
function setOption(key,value){options[key]=value;JsCookie.set(cookieName,JSON.stringify(options));}
return{getTails:function(){return _tails;},toggle:function(){setOption('mode',options.mode?0:1);(_window.opener||_window).location.reload();if(_window.opener){_window.close();}},log:function(report){if(typeof report!='object'){report={content:report,title:'Report'};}
switch(options.mode){case 1:consoleFrame(report);break;default:consolePopup(report);break;}},getTextData:function(html){var a=html.indexOf('<!--{profiler}');if(a>-1){var b=html.indexOf('-->',a);if(b){return html.slice(html.indexOf('}',a)+1,b);}}
return null;},load:function(e){var html=document.querySelector('console').innerHTML;var cookie=JsCookie.get(cookieName);if(cookie){try{options=Object.assign(options,JSON.parse(cookie));}catch(e){}}
this.log(this.getTextData(html));},};})();const JsUrl=(function(){const options=JsOptions('url').get({useRewrite:false,setLang:false,lang:'lang',go:'goto',format:'format',});function toQueryString(args){let arr=[];for(let name in args){arr.push(name+'='+encodeURIComponent(args[name]));}
return arr.join('&');}
let lang=options.setLang?document.querySelector('html').getAttribute('lang'):false;if(lang){lang=lang.replace('-','_');}
return function(route,args,format){route=route.split('/');args=Object.assign({},args);let access_point=route[0];let component=route[1]||'';let task=route[2]||'';let separator='?';let url;if(access_point=='front'){access_point='';}
if(options.useRewrite){url=[];if(lang){url.push(lang);}
if(access_point){url.push(access_point);}
if(component){url.push(component);}
if(task){url.push(task);}
url=url.join('/');}else{url='index.php';let go=[];let _args={};if(access_point){go.push(access_point);}
if(component){go.push(component);}
if(task){go.push(task);}
if(go.length){_args[options.go]=go.join('/');}
if(lang){_args[options.lang]=lang;}
if(Object.keys(_args).length){url+=separator+toQueryString(_args);separator='&';}}
if(format){args[options.format]=format;}
if(Object.keys(args).length){url+=separator+toQueryString(args);}
return url;};})();function JsTabs(tablist,options){options=Object.assign({},options);if(typeof options.onSelect!=='function'){options.onSelect=null;}
if(typeof tablist==='string'){tablist=document.querySelector(tablist);}
if(!(tablist instanceof Element)){return null;}
for(var tabpanel=tablist.nextSibling;tabpanel.nodeType!=1;tabpanel=tabpanel.nextSibling);function getChildNodes(el,tagName){let nodes=[];for(let i=0,L=el.childNodes.length;i<L;i++){if(el.childNodes[i].tagName==tagName){nodes.push(el.childNodes[i]);}}
return nodes;}
let handle,selected;let tabs=getChildNodes(tablist,'LI');let panels=getChildNodes(tabpanel,'DIV');let total=tabs.length;let lastTab=total-1;tabs.forEach(function(el,index){el.setAttribute('aria-setsize',total);el.setAttribute('aria-posinset',index+1);el.setAttribute('tabindex',0);el.addEventListener('click',function(event){event.preventDefault();that.select(index);});el.addEventListener('keydown',function(event){if(event.key==='Enter'){document.activeElement.click();}else if(event.key==='ArrowLeft'){that.prev();tabs[selected].focus();}else if(event.key==='ArrowRight'){that.next();tabs[selected].focus();}});});let that={select:function(index){if(typeof index!='number'||index>lastTab){index=0;}else if(index<0){index=lastTab;}
if(index!=selected){selected=index;let status;for(var i=0;i<total;i++){status=(i==index);tabs[i].setAttribute('aria-selected',status);tabs[i].setAttribute('tabindex',status?0:-1);tabs[i].className=panels[i].className=(status?'selected':'');if(options.onSelect){options.onSelect.call(that,i,status);}}
if(handle){clearTimeout(handle);}
handle=setTimeout(function(){panels[index].classList.add('active')},10);}
return this;},prev:function(){this.select(selected-1);},next:function(){this.select(selected+1);},selectedTabNumber:function(){return selected;},getContainer:function(number=-1){if(number<0){number=selected;}
return panels[number];},isEmpty:function(number,spinner=true){if(selected==number&&!panels[number].innerHTML){if(spinner){panels[number].innerHTML='<div class="box-loading"><i class="fa-solid fa-circle-notch fa-spin"></i></div>';}
return true;}
return false;},};return that;}
JsRequest.implement({xjs:function(options){return this.ajax(options,{format:'xjs',responseType:'json',update:false,onSuccess:(function(fn){return function(json){if(typeof json.data=='object'){if(json.data.__reloadPage){window.location.reload();}
if(typeof json.data.__redirectTo=='string'){window.location=new URL(json.data.__redirectTo,window.location.origin).href;}
if(json.data.__goBack){window.history.go(-1);}}
fn.call(options,json.message,json.code,json.data);}})(options.onSuccess),});},});function JsCollection(elements,options){options=Object.assign({url:'',minToRequest:1,justUse:0,},options);var that={attach:function(elements){Iterable(elements).forEach(function(input){if(input.getAttribute('data-multiple')){JsCollectionSelectorMultiple(input,options);}else{JsCollectionSelector(input,options);}});return true;},};options.fireEvent=function(eventName,context){if(typeof this[eventName]=='function'){return this[eventName].apply(context,arguments);}};that.attach(elements);return that;}
function JsCollectionSelector(input,options){var name=input.name;var wrapper=input.parentNode.parentNode;var xmark=wrapper.querySelector('button');var hidden=wrapper.querySelector('input[type=hidden]');var picker=JsCollectionPicker(wrapper,input,options,function(value,caption,justUse){input.value=caption;input.name=justUse?name:'';hidden.value=value;active(false);});function clear(){hidden.value='';input.name='';}
function active(status){if(status){if(input.readOnly){clear();input.value='';input.readOnly=false;input.parentNode.removeChild(xmark);input.focus();}}else{input.readOnly=true;input.parentNode.appendChild(xmark);}}
if(hidden.value){active(false);}else{input.parentNode.removeChild(xmark);}
input.name='';input.addEventListener('click',function(){active(true);});input.addEventListener('input',function(){clear();if(input.value.length<options.minToRequest){return picker.hide();}
JsCollectionEngine(input,picker,options);});input.addEventListener('reset',function(){active(true);});xmark.addEventListener('click',function(){active(true);});}
function JsCollectionSelectorMultiple(input,options){let value=JSON.parse(input.getAttribute('data-options'));let __name=input.name;let name=input.name.slice(2);input.name='';let wrapper=input.parentNode.parentNode;let group=wrapper.querySelector('ul');let picker=JsCollectionPicker(wrapper,input,options,function(value,caption,justUse){let tagName=justUse?__name:name;if(justUse){value=caption;}
let html='<div class="input-tag">'+caption
+'<input type="hidden" name="'+tagName+'[]" value="'+value+'"/>'
+'</div>'
+'<a href="javascript:void(0)" class="input-tag" role="button" aria-labelledby="collection-delete-option"><i class="fa-solid fa-xmark"></i></a>';let tag=group.appendChild(JsElement('li.input-tag-group',{html:html}));tag.setAttribute('role','option');tag.querySelector('a').addEventListener('click',function(){tag.parentNode.removeChild(tag);options.fireEvent('onDelete',picker);});input.value='';});for(let i in value){picker.create(i,value[i]);}
input.addEventListener('input',function(){if(input.value.length<options.minToRequest){return picker.hide();}
JsCollectionEngine(input,picker,options);});}
function JsCollectionPicker(wrapper,input,options,select){let status;let selected=-1;let picker=wrapper.querySelector('div[role=listbox]');let body=document.querySelector('body');input.addEventListener('keydown',function(event){if(event.key=='Enter'){event.preventDefault();if(selected>-1){picker.querySelectorAll('ul li')[selected].click();}else{input.click();}}else if(event.key=='ArrowDown'){event.preventDefault();nav(true);}else if(event.key=='ArrowUp'){event.preventDefault();nav(false);}else{selected=-1;}});function nav(forward){if(status){let li=picker.querySelectorAll('ul li');let total=li.length;selected+=forward?1:-1;if(selected<0){selected=0;}else if(selected>(total-1)){selected=(total-1);}
li.forEach(function(el,i){el.classList.toggle('active',i==selected);});}}
function toggle(i){status=Boolean(i);body[['removeEventListener','addEventListener'][i]]('click',picker.hide);picker.style.display=['none',''][i];input.setAttribute('aria-expanded',status);}
return JsElement(picker,{events:{click:function(event){event.stopPropagation();}},show:function(){toggle(1);},hide:function(){toggle(0);},select:function(value,caption,justUse){if(options.fireEvent('onSelect',this,value,caption)===false){return;}
select(value,caption,justUse);this.hide();options.fireEvent('onSuccess',this);},create:select,});}
var JsCollectionEngine=(function(){var input,picker,options;var Libraries=[];var Tables=[];var RQ={'[áàâä]':'a','[éèêë]':'e','[íìîï]':'i','[óòôö]':'o','[úùûü]':'u','[ñ]':'n'};var QR={'a':'[aáàâä]','e':'[eéèêë]','i':'[iíìîï]','o':'[oóòôö]','u':'[uúùûü]','n':'[nñ]'};function _findL(q){let i=q.length+1;while(i--){if(Libraries[i]){let j=Libraries[i].length;while(j--){if(Libraries[i][j].q==q){return Libraries[i][j];}}}
q=q.substr(0,i-1);}
return false;}
function getRegExp(re){for(let i in QR){re=re.replace(RegExp(i,'gi'),QR[i]);}
return RegExp(re,'i');}
function _findQ(Library,q){let rows=[];let length=Library.rows.length;if(length){let re=getRegExp(q);for(let j=0;j<length;j++){i=Library.rows[j];if(Tables[Library.iT].rows[i][1].search(re)!=-1){rows.push(i);}}}
return _saveL(q,Library.iT,rows);}
function _callback(q,json){json.isAll=json.isTable||json.isAll;let iT=Tables.push({rows:json.rows,isAll:json.isAll,})-1;let rows=[];for(let i in json.rows){rows[i]=i;}
if(json.isTable){_printL(_findQ(_saveL('',iT,rows),q));}else{_printL(_saveL(q,iT,rows));}}
function _saveL(q,iT,rows){let i=q.length;if(!Libraries[i]){Libraries[i]=[];}
let j=Libraries[i].push({q:q,iT:iT,rows:rows,})-1;return Libraries[i][j];}
function _printL(Library){let rows=[];let length=Library.rows.length;for(let i=0;i<length;i++){rows[i]=Tables[Library.iT].rows[Library.rows[i]];}
render(rows,Library.q);}
function renderLine(ul,value,dt,dd,ju){let html='<div class="dt">'+dt+'</div>';if(dd){html+='<div class="dd">'+dd+'</div>';}
let li=ul.appendChild(JsElement('li',{html:html}));if(ju){li.classList.add('just-use');li.setAttribute('aria-labelledby','collection-just-use')}
li.setAttribute('role','option');li.setAttribute('aria-label',dt);li.addEventListener('click',function(){picker.select(value,dt,ju);});}
function render(rows,q){let ju=options.justUse&&input.value;let ul=JsElement('UL');rows.forEach(function(row){renderLine(ul,row[0],row[1],row[2],false);if(ju&&row[1].toLowerCase()==q){ju=false;}});if(ju){let value=input.value.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');renderLine(ul,-1,value,'',true);}
if(ul.firstChild){picker.innerHTML='';picker.appendChild(ul);picker.show();}else{picker.hide();}}
function normalize(q){q=q.toLowerCase();for(i in RQ){q=q.replace(RegExp(i,'g'),RQ[i]);}
return q;}
return function(i,p,o){input=i;picker=p;options=o;var q=normalize(input.value);var Library=_findL(q);if(Library){if(Library.q==q){return _printL(Library);}else if(Tables[Library.iT].isAll){return _printL(_findQ(Library,q));}}
JsRequest.json({url:options.url,data:JsRequest.mergeData(options.data,{q:q}),onSuccess:function(json){_callback(q,json);},});};})();var cropImage=function(src,callback,options,LastPosition){let image=new Image();image.src=src;image.onload=function(){let isProportional;const limits={};const minWH=40;const wrapper=JsElement('div.crop-image',{html:'<div><div><div></div><div></div><div></div><div></div></div></div><button class="btn btn-primary btn-solid btn-block">OK</button>'});const lightbox=Lightbox({hideWithOverlay:false}).setContent(wrapper);const container=wrapper.querySelector('div');const frame=container.querySelector('div');const handle=frame.querySelectorAll('div');const enter=wrapper.querySelector('button');function set(values){for(let i in values){limits[i]=values[i];}}
function between(v,min,max){return v<min?min:(v>max?max:v);}
function resize(styles){for(let i in styles){frame.style[i]=styles[i]===null?'initial':styles[i]+'px';}}
function resizeStartFn(i){return function(event){event.stopPropagation();event.preventDefault();let position={top:null,right:null,bottom:null,left:null};let a=container.getBoundingClientRect();let b=frame.getBoundingClientRect();switch(i){case 0:case 3:set({iniX:event.clientX+b.width,maxW:b.x-a.x+b.width,signX:-1});position.right=a.x+a.width-b.x-b.width;break;case 1:case 2:set({iniX:event.clientX-b.width,maxW:a.x+a.width-b.x,signX:1});position.left=b.x-a.x;break;}
switch(i){case 0:case 1:set({iniY:event.clientY+b.height,maxH:b.y+b.height-a.y,signY:-1});position.bottom=a.y+a.height-b.y-b.height;break;case 2:case 3:set({iniY:event.clientY-b.height,maxH:a.y+a.height-b.y,signY:1});position.top=b.y-a.y;break;}
resize(position);if(!isProportional){isProportional=event.shiftKey==1;}};}
function resizeMoveFn(event){let styles={width:between(limits.signX*(event.clientX-limits.iniX),minWH,limits.maxW)};if(isProportional){styles.height=styles.width*options.proportion;if(styles.height>limits.maxH){styles.height=limits.maxH;styles.width=limits.maxH/options.proportion;}}else{styles.height=between(limits.signY*(event.clientY-limits.iniY),minWH,limits.maxH);}
resize(styles);}
container.insertBefore(image,container.firstChild);for(let i=0;i<4;i++){JsMove(handle[i],resizeStartFn(i),resizeMoveFn);}
JsMove(frame,function(event){event.stopPropagation();event.preventDefault();let a=container.getBoundingClientRect();let b=frame.getBoundingClientRect();set({iniX:event.clientX-b.x+a.x,iniY:event.clientY-b.y+a.y,maxX:a.width-b.width,maxY:a.height-b.height});},function(event){resize({left:between(event.clientX-limits.iniX,0,limits.maxX),top:between(event.clientY-limits.iniY,0,limits.maxY)});});options=Object.assign({proportion:null},options);if(typeof LastPosition!='function'){LastPosition=function(position){return position||{};};}
var position=LastPosition();if(!Object.keys(position).length){var a=container.getBoundingClientRect();var proportion=a.height/a.width;position={top:0,left:0,width:a.width,height:a.height};if(options.proportion){isProportional=true;if(proportion>options.proportion){position.height=position.width*options.proportion;position.top=(a.height-position.height)/2;}else{position.width=position.height/options.proportion;position.left=(a.width-position.width)/2;}}else{options.proportion=proportion;}}
resize(position);enter.addEventListener('click',function(){let a=container.getBoundingClientRect();let b=frame.getBoundingClientRect();let correctorX=image.naturalWidth/a.width;let correctorY=image.naturalHeight/a.height;let left=b.x-a.x;let top=b.y-a.y;let x=left*correctorX;let y=top*correctorY;let width=b.width*correctorX;let height=b.height*correctorY;let canvas=JsElement('canvas');let ctx=canvas.getContext('2d');let mime=image.src.split(':')[1].split(';')[0];canvas.width=width;canvas.height=height;ctx.drawImage(image,x,y,width,height,0,0,width,height);callback(canvas.toDataURL(mime));LastPosition({top:top,left:left,width:b.width,height:b.height});lightbox.remove();});};};var FeDate=(function(){var Picker=(function(){var Locale=null;return function(fn,withTime){var date;var selected;var firstDayOfWeek=1;var _panels={};var icons=['fa-solid fa-chevron-left','fa-solid fa-circle','fa-solid fa-chevron-right','fa-solid fa-chevron-up','fa-solid fa-chevron-down','fa-regular fa-clock',];function setSelected(){selected=new Date(date.getTime());}
function select(){setSelected();fn(date);return this;}
function builder(selector,cols,rows=1){var thead='';var tbody='';if(typeof rows=='object'){for(var i=0,L=rows.length;i<L;i++){thead+='<th>'+rows[i]+'</th>';}
rows=L;thead='<thead><tr>'+thead+'</tr></thead>';}
for(var i=0,L=rows*cols;i<L;i++){tbody+=(!(i%cols)&&i?'</tr><tr>':'')+'<td></td>';}
picker.querySelector(selector).innerHTML='<table>'
+thead
+'<tbody><tr>'+tbody+'</tr></tbody>'
+'</table>';var grids=Array.from(picker.querySelectorAll(selector+' table tbody tr td'));var that={click:function(fn){grids.forEach(function(el,i){el.addEventListener('click',function(){fn(el,i);});});return that;},icon:function(v){grids.forEach(function(el,i){if(v[i]){el.innerHTML='<i class="'+icons[v[i]-1]+'"></i>';}});return that;},html:function(fn){grids.forEach(function(el,i){el.innerHTML=fn(i);});return that;},set:function(methods){for(var i in methods){_panels[i]=methods[i].bind({grids:grids});}
return that;},};return that;}
function toggle(opt){if(opt&&picker.classList.contains('x'+opt)){opt=0;}
switch(opt){case 0:_panels.updateDays();break;case 1:_panels.updateMonths();break;case 2:_panels.updateYears();break;case 3:_panels.updateHours();_panels.updateMinutes();break;}
picker.className='fe-date x'+opt;}
if(!Locale){Locale={months:[],shortMonths:[],shortWeekdays:[]};var auxDate=new Date();for(var i=0;i<12;i++){auxDate.setMonth(i);Locale.months[i]=auxDate.toLocaleString(undefined,{month:'long'});Locale.shortMonths[i]=auxDate.toLocaleString(undefined,{month:'short'});}
for(var i=0;i<7;i++){Locale.shortWeekdays[i]=new Date(2017,9,i+1).toLocaleString(undefined,{weekday:'short'});}}
var picker=JsElement('div.fe-date',{html:'<div class="header"></div>'
+'<div class="s-days"><div class="days"></div><div class="nav"></div></div>'
+'<div class="s-months"></div>'
+'<div class="s-years"><div class="years"></div><div class="nav"></div></div>'
+(withTime?'<div class="s-time"></div><div class="s-hours"></div><div class="s-minutes"></div>':'')});picker.setStyles=function(styles){for(var i in styles){this.style[i]=styles[i];}};picker.load=function(v){date=v||new Date();setSelected();toggle(0);};builder('.header',withTime?3:2).click(function(el,i){toggle(i+1);}).set({updateHeader:function(year,month=-1){this.grids[1].innerHTML=year;if(month>-1){this.grids[0].innerHTML=Locale.months[month];}}}).icon([0,0,6]);builder('.s-days .nav',3).click(function(el,i){_panels.updateDays(i-3);}).icon([1,2,3]);var rows=[];for(var i=0;i<7;i++){rows.push(Locale.shortWeekdays[(firstDayOfWeek+i)%7]);}
builder('.days',7,rows).click(function(el){var month;var day=el.innerHTML;if(el.className=='ext'){month=day<15?-1:-3;}
_panels.updateDays(month,day);select();_panels.updateDays();}).set({updateDays:function(monthCmd,dayCmd){if(monthCmd!=undefined){switch(monthCmd){case-2:var curDate=new Date();date.setFullYear(curDate.getFullYear(),curDate.getMonth(),curDate.getDate());break;case-3:case-1:monthCmd+=2+date.getMonth();default:date.setMonth(monthCmd);break;}}
if(dayCmd!=undefined){date.setDate(dayCmd);}
var month=date.getMonth();var year=date.getFullYear();var firstDay=(7-firstDayOfWeek+(new Date(year,month,1).getDay()))%7;var lastDay=new Date(year,month+1,0).getDate();var prevDays=new Date(year,month,0).getDate()-firstDay;var day=nextDays=0;var fn=function(el,i,css){el.innerHTML=i;el.className=css;};for(var i=0;i<42;i++){if(i>=firstDay&&day<lastDay){fn(this.grids[i],++day,'');}else{fn(this.grids[i],day?++nextDays:++prevDays,'ext');}}
var curDate=new Date();if(curDate.getFullYear()==year&&curDate.getMonth()==month){this.grids[curDate.getDate()+firstDay-1].classList.add('today');}
if(selected&&selected.getFullYear()==year&&selected.getMonth()==month){this.grids[selected.getDate()+firstDay-1].classList.add('selected');}
_panels.updateHeader(year,month)}});builder('.s-months',4,3).click(function(el,i){_panels.updateDays(i);toggle(0);}).html(function(i){return Locale.shortMonths[i];}).set({updateMonths:function(){var i=12;var month=date.getMonth();while(i--){this.grids[i].className=(i==month?'selected':'');}}});builder('.s-years .nav',2).click(function(el,i){_panels.updateYears(i?1:-1);}).icon([1,3]);builder('.years',3,5).click(function(el){date.setFullYear(el.innerHTML);_panels.updateDays();toggle(1);}).set({updateYears:function(page){var i=15;var year=date.getFullYear();if(page){year+=(page*i);date.setFullYear(year);}
while(i--){this.grids[i].innerHTML=year+i-7;this.grids[i].className=(i==7?'selected':'');};_panels.updateHeader(year);}});if(withTime){builder('.s-time',2,3).click(function(el,i){switch(i){case 0:_panels.updateHours(1);break;case 1:_panels.updateMinutes(1);break;case 2:toggle(4);break;case 3:toggle(5);break;case 4:_panels.updateHours(-1);break;case 5:_panels.updateMinutes(-1);break;}}).icon([4,4,0,0,5,5]).set({updateHours:function(v){if(v){v+=date.getHours();date.setHours(v>23?0:(v<0?23:v));}
this.grids[2].innerHTML=pad(date.getHours());select();},updateMinutes:function(v){if(v){v+=date.getMinutes();date.setMinutes(v>59?0:(v<0?59:v));}
this.grids[3].innerHTML=pad(date.getMinutes());select();}});builder('.s-hours',4,6).click(function(el,i){date.setHours(i);toggle(3);_panels.updateHours();}).html(function(i){return pad(i);});builder('.s-minutes',3,4).click(function(el,i){date.setMinutes(i*5);toggle(3);_panels.updateMinutes();}).html(function(i){return pad(i*5);});}
return picker;};})();function pad(number){if(number<10){return'0'+number;}
return number;}
function newDate(textDate){var match=textDate.match(/^\d{4}-\d{2}-\d{2}(T\d{2}:\d{2}(:\d{2})?)?$/);if(!match){return;}else if(match[1]==undefined){textDate+='T00:00:00';}else if(match[2]==undefined){textDate+=':00';}
return new Date(textDate);};return function(elements,options){var _picker,_curElement;var that={attach:function(elements){elements=Iterable(elements);var i=elements.length;while(i--)(function(el){var name=el.name;el.name='';el.setAttribute('readonly',true);var H=el.parentNode.insertBefore(JsElement('INPUT',{'type':'hidden','name':name}),el);el.getHDate=function(){return H.value?newDate(H.value):false;};el.setHDate=function(v){this.value=v.toLocaleDateString()
+(options.type?' '+v.toLocaleTimeString().replace(/^(\d{1,2}:\d{1,2}):\d{1,2}([^\d]*)$/,'$1$2'):'');H.value=v.getFullYear()
+'-'+pad(v.getMonth()+1)
+'-'+pad(v.getDate())
+(options.type?'T'+pad(v.getHours())+':'+pad(v.getUTCMinutes()):'');};if(el.value){var ct=newDate(el.value);if(ct){el.setHDate(ct);}else{el.value='';}}
if(options.setDrop){el.addEventListener('focus',function(){that.show(el);});}})(elements[i]);},show:function(el){_curElement=el;this.displayTime=Date.now();if(options.setPosition&&_curElement){var rect=_curElement.getBoundingClientRect();_picker.setStyles({position:'absolute',top:(rect.top+rect.height+3)+'px',left:rect.left+'px','z-index':1000});}
_picker.load(_curElement?_curElement.getHDate():false);_picker.setStyles({display:'block'});this.fireEvent('onShow');return this;},hide:function(){_picker.setStyles({display:'none',position:'',top:'',left:'',});this.fireEvent('onHide');_curElement=null;return this;},fireEvent:function(name,param){if(typeof options[name]=='function'){this[name]=options[name];this[name](param);}},};options=Object.assign({inject:null,setPosition:1,setDrop:1,offset:{x:5,y:-3},type:0,onSelect:function(date){_curElement&&_curElement.setHDate(date);},},options);options.type=options.type=='datetime-local'?1:0;if(typeof options.inject=='string'){options.inject=document.querySelector(options.inject);}
that.attach(elements);_picker=new Picker(options.onSelect.bind(that),options.type);if(options.setDrop){document.querySelector('html').addEventListener('click',function(){if(_picker.style.display=='block'&&Date.now()-that.displayTime>200){that.hide();}});_picker.setStyles({display:'none'});_picker.addEventListener('click',function(event){event.stopPropagation();return false;});}else{_picker.load();}
(options.inject||document.body).appendChild(_picker);return that;};})();JsFelem.implement({'date':function(el){FeDate(el);},'datetime-local':function(el){FeDate(el,{'type':'datetime-local'});}});JsFelem.observe({'input[type=date]':function(el){if(el.type!='date'){FeDate(el,{'type':'date'});}},'input[type=datetime-local]':function(el){if(el.type!='datetime-local'){FeDate(el,{'type':'datetime-local'});}}});const UploadHandle=function(el,form,data){var _data;var WH=['width','height'];var options={thumb_wh:78,max_wh:1200,max_size:0,proportion:0,accept:null,images:null,caption:null,reorder:false,};function resize(img,max_wh){let x=0;let y=0;let width=img.width;let height=img.height;if(options.proportion){let proportion=height/width;if(proportion>options.proportion){height=width*options.proportion;y=(img.height-height)/2;}else{width=height/options.proportion;x=(img.width-width)/2;}}
let maj=WH[width>height?0:1];if(x||y||img[maj]>max_wh){let min=WH[maj==WH[0]?1:0];let minWH=width>height?height*max_wh/width:width*max_wh/height;let canvas=JsElement('canvas');let ctx=canvas.getContext('2d');canvas[maj]=max_wh;canvas[min]=Math.round(minWH);ctx.drawImage(img,x,y,width,height,0,0,canvas.width,canvas.height);return canvas.toDataURL(getMimeType(img.src));}
return img.src;}
function getMimeType(src){return src.split(':')[1].split(';')[0];}
function dataURItoBlob(data){data=data.split(',');let mime=getMimeType(data[0]);let bytes=atob(data[1]);let length=bytes.length;let buffer=new ArrayBuffer(length);let uint8=new Uint8Array(buffer);for(let i=0;i<length;i++){uint8[i]=bytes.charCodeAt(i);}
return new Blob([new DataView(buffer)],{type:mime});}
function getAccept(accept){if(!accept){return'*/*';}
if(['audio','image','video'].includes(accept)){return accept+'/*';}
return accept;}
function createElement(el){let container=JsElement('div.input-file'+(isMultiple?' multiple':''));let AddButton=container.appendChild(JsElement('div',{html:'<div class="uh-icon"><i class="fa-solid fa-cloud-arrow-up"></i></div><div>'+options.caption+'</div>','class':'input-field uh-btn',tabindex:0,role:'button',events:{click:function(event){event.stopPropagation();var f=document.body.appendChild(JsElement('input',{type:'file',accept:getAccept(options.accept),multiple:isMultiple,styles:{display:'none',},events:{change:function(){addFiles(f);},},}));f.click();},keydown:function(event){if(event.key=='Enter'){event.preventDefault();event.target.click();}},dragover:function(event){event.preventDefault();},drop:function(event){event.preventDefault();if(event.dataTransfer.files.length){addFiles(event.dataTransfer);}},},toggle:function(status){this.style.display=status?'':'none';if(status){this.focus();}},}));function addFiles(el){if(!isMultiple){AddButton.toggle(false);}
var length=el.files.length;for(var i=0;i<length;i++){(function(file){var frame=newFrame(file.name);var reader=new FileReader();reader.readAsDataURL(file);reader.onprogress=function(response){frame.proggressBar(Math.round(response.loaded/response.total)*100);};reader.onload=function(){frame.proggressBar(-1);if(file.type.match('image.*')){var img=new Image();img.src=this.result;img.onload=function(){let src=resize(this,options.max_wh);frame.removeTitle();frame.addThumb(src);frame.appendData(dataURItoBlob(src),file.name);frame.addCropImage(this.src,dataID);};}else{frame.addFileIcon();frame.appendData(file,file.name);}};})(el.files[i]);}}
var hidden;function reorder(){if(!hidden){hidden=form.appendChild(JsElement('input',{'type':'hidden','name':'__'+_name.substr(0,_name.length-2)}));}
let names=[];Array.from(container.querySelectorAll('div > div[data-name]')).forEach(function(frame){names.push(frame.getAttribute('data-name'));});hidden.value=names.join('|');}
function newFrame(title){let attr={html:'<div>'+(title?'<div class="uh-title">'+title+'</div>':'')+'</div>',tabindex:0,title:title,'aria-label':title,events:{keydown:function(event){event.stopPropagation();if(event.key=='Delete'){remove();}else if(event.key=='Enter'){let el=frame.querySelector('.uh-crop');if(el){el.click();}}}}};if(options.reorder){Object.assign(attr,{draggable:true,events:{dragstart:function(){container.curDrag=this;},dragover:function(event){event.preventDefault();event.dataTransfer.dropEffect='move';return false;},drop:function(event){event.preventDefault();var c=container.curDrag;if(c){switch(c.compareDocumentPosition(this)){case 4:if(this.nextSibling){container.insertBefore(c,this.nextSibling);}else{container.appendChild(c);}
break;case 2:container.insertBefore(c,this);break;}}
reorder();return(container.curDrag=false);}}});}
let frame=container.appendChild(JsElement('div.input-field',attr));let box=frame.querySelector('div');function remove(){if(typeof dataID!='undefined'){_data[--dataID]=false;}
container.removeChild(frame);reorder();AddButton.toggle(true);}
function addThumb(img,name){if(typeof img=='string'){var _img=new Image();_img.src=img;_img.onload=function(){addThumb(this);};if(name){frame.appendChild(JsElement('input',{'type':'hidden','name':name,'value':1}));}}else{let el=box.querySelector('img');if(el){el.parentNode.removeChild(el);}
box.parentNode.classList.add('uh-img');box.appendChild(img);}
return this;}
function addCross(){box.appendChild(JsElement('div.uh-cross',{html:'<i class="fa-solid fa-xmark"></i>',events:{click:function(){remove();}}}));return this;}
return{proggressBar:(function(){var bar;return function(value){if(value==-1){return box.removeChild(bar);}else if(!bar){bar=box.appendChild(JsElement('div.uh-proggress'));}
bar.style.width=value+'%';};})(),removeTitle(){box.removeChild(box.querySelector('.uh-title'));},addThumb:addThumb,addCross:addCross,addCropImage:function(src,dataID){var LastPosition=(function(){var position={};return function(value){if(value){position=value;}
return position;};})();box.appendChild(JsElement('div.uh-crop',{html:'<i class="fa-solid fa-crop-simple"></i>',events:{click:function(){cropImage(src,function(src){var img=new Image();img.src=src;img.onload=function(){let src=resize(this,options.max_wh);_data[dataID-1][1]=dataURItoBlob(src);addThumb(src);frame.focus();};},options,LastPosition);}}}));return this;},appendData:function(src,filename){if(options.max_size&&options.max_size<src.size){box.innerHTML='<div class="uh-icon"><i class="fa-solid fa-triangle-exclamation"></i></div>';}else{dataID=_data.push([_name,src,filename]);}
if(isMultiple){this.setName(filename);}
addCross();},remove:remove,setName:function(v){box.setAttribute('data-name',v);reorder();},addFileIcon:function(){box.innerHTML='<div class="uh-icon"><i class="fa-regular fa-file"></i></div>'+box.innerHTML;}};}
el.parentNode.insertBefore(container,el);el.parentNode.removeChild(el);return{addFrame:function(title){if(!isMultiple){AddButton.toggle(false);}
return newFrame(title);},};};if(!form||form.tagName!='FORM'){for(form=el;form.tagName!='FORM';form=form.parentNode){if(form.tagName=='BODY'){return;}}}
try{Object.assign(options,JSON.parse(el.getAttribute('data-options')));}catch(e){}
_data=data||[];var _name=el.name;var isMultiple='multiple'in JsElement('input')&&el.multiple;if(typeof options.max_wh!='number'){if(options.max_wh.indexOf('x')>-1){let wh=options.max_wh.split('x',2).map(v=>parseInt(v));if(wh[0]>0){options.proportion=wh[1]/wh[0];}
options.max_wh=wh[0]>wh[1]?wh[0]:wh[1];}else{options.max_wh=parseInt(options.max_wh);}}
UH=createElement(el);if(options.images&&options.images[1]){if(isMultiple){options.images[1].forEach(function(v){UH.addFrame().addThumb(options.images[0]+v).addCross().setName(v);});}else{UH.addFrame().addThumb(options.images[0]+options.images[1],_name).addCross();}}
form.addEventListener('reset',function(){var frames=UH.querySelectorAll('.uh-cross');var i=frames.length;while(i--){frames[i].click();}});};JsFelem.implement({file:function(el,form,data){UploadHandle(el,form,data);}});JsFelem.implement({suite:function(el){var name=el.getAttribute('data-name');var box=el.querySelectorAll('li');var All=box[1].querySelectorAll('label');var selected=el.getAttribute('data-selected');var checkAll=el.querySelector('input[type=checkbox]');var Has={};var _count=0;var _total=All.length;function reset(_selected){box[0].querySelectorAll('input').forEach(function(el){Has[el.value](0);});if(typeof _selected!='string'){_selected=selected;}
if(_selected){_selected.split(',').forEach(function(k){if(typeof Has[k]!='undefined'){Has[k](1);}});}}
function dragAndDrop(tag){var corrector,current;JsMove(tag,function(){var target=tag.getBoundingClientRect();var rect=box[0].getBoundingClientRect();corrector={x:target.width/2+rect.left+(window.pageXOffset||document.documentElement.scrollLeft),y:target.height/2+rect.top+(window.pageYOffset||document.documentElement.scrollTop)};},function(event){tag.style.position='absolute';tag.style.left=(event.pageX-corrector.x)+'px';tag.style.top=(event.pageY-corrector.y)+'px';if(current){var target=current.getBoundingClientRect();if(!(target.top<event.clientY&&target.bottom>event.clientY&&target.left<event.clientX&&target.right>event.clientX)){current=null;}}
if(!current){box[0].querySelectorAll('label').forEach(function(x){var target=x.getBoundingClientRect();if(x!=tag&&target.top<event.clientY&&target.bottom>event.clientY&&target.left<event.clientX&&target.right>event.clientX){current=x;}});}},function(){if(current){var target=tag.getBoundingClientRect();var rect=current.getBoundingClientRect();if(rect.left+rect.width/2<target.left+target.width/2){if(current.nextSibling){box[0].insertBefore(tag,current.nextSibling);}else{box[0].appendChild(tag);}}else{box[0].insertBefore(tag,current);}
current=null;}
tag.style.position='';tag.style.left='';tag.style.top='';});}
All.forEach(function(el){var tag;var isSelected=el.classList.contains('selected');var value=el.getAttribute('data-value');var fn=function(show){if(isSelected===show){return;}
if(typeof tag=='undefined'){tag=JsElement('label.input-tag selected',{html:'<input type="hidden" name="'+name+'[]" value="'+value+'"/>'+el.innerHTML});dragAndDrop(tag);}
if(show){box[0].appendChild(tag);el.classList.add('selected');_count++;}else{box[0].removeChild(tag);el.classList.remove('selected');_count--;}
checkAll.checked=(_count==_total);isSelected=show;};el.value=value;el.addEventListener('click',function(){fn(el.classList.contains('selected')?0:1);});Has[value]=fn;});var toggle=function(force){var v=['','none',''];box[0].style.display=v[force];box[1].style.display=v[force+1];btn.forEach(function(el,j){el.style.display=v[force+(j==3?0:1)];});};checkAll.addEventListener('change',function(){var force=checkAll.checked==true?1:0;All.forEach(function(el){Has[el.value](force);});});var btn=el.querySelectorAll('div');btn[0].addEventListener('click',function(){toggle(0)});btn[1].addEventListener('click',reset);btn[3].addEventListener('click',function(){toggle(1)});toggle(1);reset(selected);el.value=selected;el.type='suite';el.reset=reset;}});function Backlist(ID){function Rows(_controls){let rows=[];let that={getButtons:function(){return _buttons;},getCheckAll:function(){return _checkall;},add:function(row){let checkbox=row.querySelector('input[type=checkbox]');if(!checkbox||checkbox.disabled){return;}
let data=row.getAttribute('row-labels');let labels=data?data.split(','):[];function toggle(state){checkbox.checked=state;row.classList.toggle('active',state);_buttons.refresh();refresh();}
checkbox.addEventListener('change',function(event){event.stopPropagation();toggle(!checkbox.checked);});row.addEventListener('click',function(){toggle(!checkbox.checked);});rows.push({checkbox,row,toggle,hasLabel:function(label){return labels.indexOf(label)!=-1;}});},restart:function(){rows=[];},numSelected:function(){let count=0;let i=rows.length;while(i--&&count<2){if(rows[i].checkbox.checked){count++;}}
return count;},hasLabel:function(label){let i=rows.length;while(i--){if(rows[i].checkbox.checked&&!rows[i].hasLabel(label)){return false;}}
return true;},hasLabelFrom:function(btn,label){let row=getRowFromButton(btn);let i=rows.length;while(i--){if(rows[i].row==row){return rows[i].hasLabel(label);}}
return true;},select:function(btn){let i=rows.length;let row=getRowFromButton(btn);while(i--){rows[i].toggle(rows[i].row==row);}}};let _buttons=Buttons(that);let _checkall=CheckAll(function(status){let i=rows.length;while(i--){rows[i].toggle(status);}
_buttons.refresh();});function refresh(){let i=rows.length;while(i--){if(!rows[i].checkbox.checked){return _checkall.checked(false);}}
return _checkall.checked(true);}
function getRowFromButton(btn){let row=btn;for(;row.getAttribute('control-row')==undefined;row=row.parentNode){if(row.tagName=='BODY'){return null;}}
return row;}
_controls.attachAll('row',{default:function(el){that.add(el);},'check-all':function(el){_checkall.add(el);},});return that;}
function Buttons(_row){let buttons=[];let rules={};let labels={};let values=[{'0':true,'1':false,'+':false,'?':true},{'0':false,'1':true,'+':true,'?':true},{'0':false,'1':false,'+':true,'?':false}];function getButton(target){return buttons.find((button)=>button.target==target);}
let that={add:function(name,target){if(['0','1','+','?'].indexOf(rules[name])!==-1){buttons.push({target:target,status:function(total){let status=values[total][rules[name]];if(status&&labels[name]){return _row.hasLabel(labels[name]);}
return status;},virtuallyStatus:function(){let status=values['1'][rules[name]];if(status&&labels[name]){return _row.hasLabelFrom(target,labels[name]);}
return status;}});}},addCmd:function(name,numRows,onlyRows){rules[name]=String(numRows);if(typeof onlyRows!=='undefined'){if(onlyRows===true){onlyRows=name;}
labels[name]=String(onlyRows);}},refresh:function(){let total=_row.numSelected();buttons.forEach(function(button){let disabled=!button.status(total);button.target.classList.toggle('disabled',disabled);button.target.setAttribute('aria-disabled',disabled);});},clean:function(){buttons=buttons.filter(function(button){return document.body.contains(button.target);});},isDisabled:function(el){return el.classList.contains('disabled')||el.getAttribute('aria-disabled')==='true';},isVirtuallyDisabled:function(el){let button=getButton(el);return button?!button.virtuallyStatus():false;}};return that;}
function CheckAll(callback){let elements=[];let that={toggle:function(force){callback(force);},check:function(){this.toggle(true);},uncheck:function(){this.toggle(false);},checked:function(force){elements.forEach(function(el){el.toggle(force);});},add:function(el){let cmd=el.getAttribute('data-checkall');if(!['uncheck','check'].includes(cmd)){cmd='toggle';}
if(el.tagName=='INPUT'){el.addEventListener('change',function(event){event.stopPropagation();that[cmd](el.checked);});el.toggle=function(force){el.checked=force;}}else{el.addEventListener('click',function(){that[cmd](el.getAttribute('data-toggle'));});el.toggle=function(force){el.setAttribute('data-toggle',force);}}
elements.push(el);},};return that;}
function Filters(_controls,callback){let $box,$filters,$form;function Sticky(el){if(typeof el=='string'){el=document.querySelector(el);}
let v=0;let H=document.querySelector('header[data-sticky]');function fn(){let top=H?H.getBoundingClientRect().height:0;if(v!=(document.documentElement.scrollTop>top)){v=el.classList.toggle('active');el.style.top=top+'px';TooltipActive.hide();}}
fn();window.addEventListener('scroll',fn);}
let that={toggle:function(){let value=$filters.style.display==''?'none':'';$filters.style.display=value;JsCookie.set('ListFilters',value);},reset:function(){callback();},setBox:function(el){el=el.querySelector('[backlist-actions]');$box=el.firstChild.nextSibling;Sticky(el);},load:function(el){$filters=el.querySelector('[backlist-filters]');if(!$filters){return;}
_controls.load('filter',el,function(el,fn){el.addEventListener('click',function(event){event.stopPropagation();fn(el,$form);});});if($box){$box.innerHTML='';$box.appendChild($filters);}
$filters.style.display=JsCookie.get('ListFilters');$form=$filters.querySelector('form');$form.addEventListener('submit',function(event){callback(event,$form)});JsFelem.load($form);}};_controls.attachAll('filter',{sort:function(el){let value=el.getAttribute('data-value');if($form.order.value==value){$form.sort.value=$form.sort.value=='desc'?'asc':'desc';}
$form.order.value=value;JsFelem.submit($form);},search:function(el){$form.search.value=el.getAttribute('data-value');let field=el.getAttribute('data-field');if(field&&typeof $form.field=='object'){$form.field.value=field;}
JsFelem.submit($form);},change:function(el){let name=el.getAttribute('data-name');let value=el.getAttribute('data-value');if($form[name].type=='checkbox'){$form[name].checked=value;}else{$form[name].value=value;}
JsFelem.submit($form);},});_controls.attachAll('list',{filters:function(){that.toggle();},'filters-reset':function(){that.reset();}});return that;}
function List($box,callback){let onSuccess;let _options={};let _page=1;let _filtersData={};let _data=null;let requiresData=false;function combine(a,b){for(let i in b){a[i]=(typeof a[i]=='object')?combine(a[i],b[i]):b[i];}
return a;}
return{setPage:function(page){_page=page;},setFilters:function(data){_filtersData=data;},setData:function(data){_data??={};if(data===undefined){requiresData=true;}else{_data=combine(_data,data);}},init:function(options,$U){if(requiresData){let $form=this.getForm();if($form){Array.from($form.elements).forEach(function(el){if(el.type=='hidden'&&el.name&&!el.disabled){_data[el.name]=el.value;}});}}
switch(typeof options){case'string':_options.url=options;break;case'object':_options=options;break;}
if(!_options.url&&$U){_options.url=$U('list');}
_options.format='text';onSuccess=typeof _options.onSuccess=='function'?_options.onSuccess:false;_options.onSuccess=function(html){$box.innerHTML=html;callback();};},request:function(){_options.data=[];if(_data!==null){_options.data.push(_data);}
if(_page>1){_options.data.push({page:_page});}
if(_filtersData){_options.data.push(_filtersData);}
$box.focus();JsRequest.load(_options);},getForm:function(name){$form=$box?$box.querySelector('[backlist-form]'):null;if(name){return typeof $form[name]!='undefined'?$form[name].value:undefined;}
return $form;},getHash:function(){return _page+(_filtersData?'/'+_filtersData:'');},fireSuccess:function(){if(onSuccess){onSuccess($box);}},};}
function Hash(_list,callback){function hash(){return window.self.document.location.hash;}
let handler,current='';let that={load:function(){if(!handler){current=hash();handler=setInterval(function(){if(current!=hash()){current=hash();that.load();callback();}},300);}
let part=current.substring(1).split('/');let page=parseInt(part.shift())||1;let filters=part.join('/');_list.setPage(page);_list.setFilters(filters);},save:function(){if(handler){window.self.document.location.hash=_list.getHash();current=hash();}
return this;},};return that;}
function Options($box,_controls,_buttons){let $form;return{load:function(){let $options=$box.querySelector('div[backlist-actions]');if(!$options){return;}
_controls.load('list',$options,function(el,fn,cmd){_buttons.add(cmd,el);function fn2(event){event.preventDefault();if(_buttons.isDisabled(el)){return;}
JsDropdown.hide();fn(el);}
if(cmd=='create'){$form=el.parentNode;if($form.tagName=='FORM'){$form.addEventListener('submit',fn2);}else{$form=false;}}
el.addEventListener('click',fn2);});JsFelem.load($options);},getData:function(data){if($form){data.push($form);}}};}
function _pagination(el,callback){let bts=Array.from(el.querySelectorAll('.footer *[control-page]'));bts.forEach(function(bt){bt.addEventListener('click',function(event){let page=parseInt(bt.getAttribute('control-page'));callback(event,page);});});}
function toQueryString($form){let data=[];Array.from($form.elements).forEach(function(el){if(el.name&&!el.disabled){if(el.type=='select-multiple'){for(let i=0;i<el.options.length;i++){if(el.options[i].selected){data.push(el.name+'='+el.options[i].value);}}}else if(['checkbox','radio'].indexOf(el.type)==-1||el.checked){data.push(el.name+'='+el.value);}}});return data.join('&');}
function objToFn(options,cmd){if(typeof options.modalOptions=='object'){options.load='modal';}else if(typeof options.load=='undefined'){options.load='xjs';}
if(!options.url&&$U){options.url=$U(cmd);}
let isEditable=(typeof options.editable!='undefined'&&options.editable);let fn=function(el){if(typeof options.onSubmit=='function'&&!options.onSubmit(el)){return;}
if(isEditable&&el.style.display!='none'){el.style.display='none';let value=el.innerHTML;let input=el.parentNode.appendChild(JsElement('input.input-field',{name:cmd,value:value,events:{click:function(event){event.stopPropagation();},keydown:function(event){if(event.key=='Enter'){event.preventDefault();input.blur();}},blur:function(){if(this.value==value){el.style.display='';input.parentNode.removeChild(input);}else{fn(el);}}},}));input.focus();return false;}
let _options=Object.assign({},options);let data=[];let $form=_list.getForm();if($form){data.push($form);}
if(cmd=='create'&&!options.numRows){_listOptions.getData(data);}
let value=el.getAttribute('data-value');if(value){data.push({[el.getAttribute('data-name')||cmd]:value});}
switch(typeof options.data){case'function':case'string':case'object':data.push(options.data);break;}
_options.data=data;JsRequest.load(_options);};return fn;}
let $U,_initialized;let $box=document.getElementById((ID?ID+'-':'')+'backlist-box');let $list=$box?.querySelector('div[backlist-slot]');if($box){JsNotify.creator($box);}
let _controls=JsControls({list:{refresh:function(){that.refresh();},view:function(el){JsDropdown(el.nextSibling).toggle();},'tg-body':function(el){el.parentNode.classList.toggle('expand');},}});let _rows=Rows(_controls);let _buttons=_rows.getButtons();let _filters=Filters(_controls,function(event,data){if(event){event.preventDefault();}
_list.setPage(1);_list.setFilters(data?toQueryString(data):'');_hash.save();that.load();});let _list=List($list,function(){that.async()});let _hash=Hash(_list,function(){that.load()});let _listOptions=Options($box,_controls,_buttons);let that={url:function(fn){if(typeof fn=='function'){$U=fn;}
return this;},data:function(data){_list.setData(data);return this;},allowHistory:function(){_hash.load();return this;},controls:function(controls,handler){if(!handler){handler='list';}
for(let cmd in controls){(function(options){switch(typeof options){case'object':if(handler!='list'){break;}
if(typeof options.numRows=='undefined'){options.numRows=(cmd=='create')?0:'+';}
_buttons.addCmd(cmd,options.numRows,options.onlyRows);if(typeof options.fn=='function'){options=options.fn;}else{options=objToFn(options,cmd);}
case'function':_controls.attach(handler,cmd,options);}})(controls[cmd]);}
return this;},setControlsWithTarget(controls,target){if(target){for(let cmd in controls){if(typeof controls[cmd]==='object'&&typeof controls[cmd].modalOptions==='object'){controls[cmd].modalOptions.target=target;}}}
return this.controls(controls);},load:function(options){if(!$box){return;}
let _request=true;if(!_initialized){_initialized=true;_request=!$list.innerHTML;_filters.setBox($box);_list.init(options,$U);_listOptions.load();Tooltip($box);}
_rows.restart();if(_request){_list.request();}else{this.async();}
return this;},async:function(){let $form=_list.getForm();if($form){_buttons.clean();_controls.load('list',$form,function(el,fn,cmd){_buttons.add(cmd,el);el.addEventListener('click',function(event){event.stopPropagation();if(_buttons.isVirtuallyDisabled(el)){return;}
_rows.select(el);fn(el);});});_controls.load('row',$form);_buttons.refresh();_pagination($list,function(event,page){_list.setPage(page);_hash.save();that.load();});_filters.load($list);_list.fireSuccess();Tooltip($list);}
return this;},refresh:function(){this.load();},getElement:function(selector){if(selector){return $box.querySelector(selector);}
return $box;},getForm:function(name){return _list.getForm(name);},getFormValue:function(name){if(!name){return null;}
return _list.getForm(name);},getFiltersData:function(){let h=location.hash.split('/')[1];let data={};if(h){h.split('&').forEach(function(row){row=row.split('=');data[row[0]]=row[1];});}
return data;},notify:function(options){$box.notify(options);},};return that;};function FormBox(box){if(!box){box=0;}
switch(typeof box){default:box='';case'number':box='#form-box'+(box||'');case'string':box=document.querySelector(box)||document.querySelector('#'+box+'-box');case'object':if(!box){return;}}
let _controls=JsControls({form:{'nav-prev':function(){that.select(selected-1);},'nav-next':function(){that.select(selected+1);},'refresh':function(){that.refresh();},},});let tabs=box.firstChild;if(tabs.classList.contains('tablist')){tabs=JsTabs(tabs);}else{tabs=false;}
let tabOptions=[];let isloaded=false;let selected=0;let panel=box;function _update(el,options,force){if(!options){return;}
function _onLoad(){_controls.load('form',el,function(el,fn){el.addEventListener('click',function(){fn();});});if(typeof options.onLoad=='function'){options.onLoad();}}
if(!force&&el.firstChild){if(!isloaded){isloaded=true;_onLoad();}}else{options.onSuccess=function(html){el.innerHTML=html;_onLoad();};JsRequest.text(options);}}
let that={controls:function(options){for(let i in options){if(typeof options[i]=='function'){_controls.attach('form',i,options[i]);}}
return this;},tab:function(options){tabOptions.push(options);return this;},select:function(i,force){if(tabs){tabs.select(i);panel=tabs.getContainer();selected=tabs.selectedTabNumber();}
_update(panel,tabOptions[selected],force);return this;},refresh:function(){this.select(selected,true);},};JsNotify.creator(that,box);return that;}
const FormRow=function(el){if(typeof el==='string'){el=document.querySelector(el);}
if(typeof el!=='object'){return null;}
function getRow(el){while(el.tagName!=='BODY'){if(el.classList.contains('form-group')){return el;}
el=el.parentNode;}}
function getSibling(el,jump){const total=Math.abs(jump);const forward=jump>0;for(let i=0;i<total;i++){if(forward){el=el.nextElementSibling;}else{el=el.previousElementSibling;}
if(!el){return null;}}
return FormRow(el);}
const $row=getRow(el);if(typeof $row!=='object'){return null;}
let that={prev:function(jump=1){return getSibling($row,-jump);},next:function(jump=1){return getSibling($row,jump);},toggle:function(status){$row.style.display=status?'':'none';return that;},clone:function(callback){let $new=$row.cloneNode(true);if(typeof callback==='function'){$new=callback($new);}
return FormRow($new);},getElement:function(selector){if(selector){return $row.querySelector(selector);}
return $row;},insertBefore:function($new){$row.parentNode.insertBefore($new.getElement(),$row);return $new;},insertAfter:function($new){const el=$row.nextElementSibling;if(el){el.parentNode.insertBefore($new.getElement(),el);}else{$row.parentNode.appendChild($new.getElement());}
return $new;},remove:function(){$row.parentNode.removeChild($row);}};return that;}
const FormFieldset=function(el){if(typeof el==='string'){el=document.querySelector(el);}
if(typeof el!=='object'){return null;}
function getRow(el){while(el.tagName!=='BODY'){if(el.classList.contains('form-fieldset')){return el;}
el=el.parentNode;}}
const $fieldset=getRow(el);if(typeof $fieldset!=='object'){return null;}
let that={getRow:function(number=0){const rows=$fieldset.querySelectorAll('.form-body .form-group');if(rows.length>number){return FormRow(rows[number]);}
return null;},getElement:function(selector){if(selector){return $fieldset.querySelector(selector);}
return $fieldset;},remove:function(){$fieldset.parentNode.removeChild($fieldset);}};return that;}
JsFelem.implement({userpicker:function(el){JsCollection(el,{url:JsUrl('admin/users/users'),});}});